"use strict";
// Appointment Management Integration Tests
// Requirements: 6.1, 6.2, 6.3, 6.4, 6.5
Object.defineProperty(exports, "__esModule", { value: true });
// Mock environment variables
process.env.APPOINTMENTS_TABLE = 'test-appointments';
process.env.EVENT_BUS_NAME = 'test-event-bus';
// Mock AWS SDK clients
jest.mock('@aws-sdk/client-eventbridge', () => ({
    EventBridgeClient: jest.fn().mockImplementation(() => ({
        send: jest.fn().mockResolvedValue({}),
    })),
    PutEventsCommand: jest.fn(),
}));
jest.mock('../../shared/data-access/appointments', () => ({
    createAppointment: jest.fn().mockResolvedValue('appt-123'),
    getAppointment: jest.fn().mockResolvedValue({
        id: 'appt-123',
        userId: 'user-123',
        provider: { name: 'Dr. Smith', specialty: 'Cardiology', phone: '+1234567890' },
        type: 'checkup',
        scheduledTime: new Date(),
        status: 'scheduled',
        reminders: { enabled: true, times: [24, 2], channels: ['push', 'sms'] },
    }),
    getAppointmentsByUser: jest.fn().mockResolvedValue([]),
    getUpcomingAppointments: jest.fn().mockResolvedValue([]),
    updateAppointment: jest.fn().mockResolvedValue(undefined),
    updateAppointmentStatus: jest.fn().mockResolvedValue(undefined),
    deleteAppointment: jest.fn().mockResolvedValue(undefined),
}));
jest.mock('../../shared/data-access/care-circle', () => ({
    getCareCircleMembers: jest.fn().mockResolvedValue([]),
}));
const create_appointment_1 = require("../create-appointment");
const get_appointments_1 = require("../get-appointments");
const update_appointment_1 = require("../update-appointment");
const delete_appointment_1 = require("../delete-appointment");
const get_appointment_ical_1 = require("../get-appointment-ical");
describe('Appointment Management Integration Tests', () => {
    const mockUserId = 'user-123';
    const mockAppointmentId = 'appt-456';
    describe('Create Appointment', () => {
        it('should create appointment with valid data', async () => {
            const event = {
                body: JSON.stringify({
                    userId: mockUserId,
                    provider: {
                        name: 'Dr. Smith',
                        specialty: 'Cardiology',
                        phone: '+1234567890',
                    },
                    type: 'checkup',
                    scheduledTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                    duration: 30,
                    location: '123 Medical Center',
                    notes: 'Annual checkup',
                }),
            };
            const result = await (0, create_appointment_1.handler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.appointmentId).toBeDefined();
            expect(body.message).toBe('Appointment created successfully');
        });
        it('should reject appointment with missing required fields', async () => {
            const event = {
                body: JSON.stringify({
                    userId: mockUserId,
                    // Missing provider, type, scheduledTime
                }),
            };
            const result = await (0, create_appointment_1.handler)(event);
            expect(result.statusCode).toBe(400);
            const body = JSON.parse(result.body);
            expect(body.error).toContain('Missing required fields');
        });
        it('should reject appointment with past scheduled time', async () => {
            const event = {
                body: JSON.stringify({
                    userId: mockUserId,
                    provider: {
                        name: 'Dr. Smith',
                        specialty: 'Cardiology',
                        phone: '+1234567890',
                    },
                    type: 'checkup',
                    scheduledTime: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), // Past date
                }),
            };
            const result = await (0, create_appointment_1.handler)(event);
            expect(result.statusCode).toBe(400);
            const body = JSON.parse(result.body);
            expect(body.error).toContain('must be in the future');
        });
        it('should reject appointment with invalid type', async () => {
            const event = {
                body: JSON.stringify({
                    userId: mockUserId,
                    provider: {
                        name: 'Dr. Smith',
                        specialty: 'Cardiology',
                        phone: '+1234567890',
                    },
                    type: 'invalid_type',
                    scheduledTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                }),
            };
            const result = await (0, create_appointment_1.handler)(event);
            expect(result.statusCode).toBe(400);
            const body = JSON.parse(result.body);
            expect(body.error).toContain('Invalid appointment type');
        });
    });
    describe('Get Appointments', () => {
        it('should get all appointments for user', async () => {
            const event = {
                pathParameters: {
                    userId: mockUserId,
                },
                queryStringParameters: null,
            };
            const result = await (0, get_appointments_1.handler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.appointments).toBeDefined();
            expect(Array.isArray(body.appointments)).toBe(true);
        });
        it('should get upcoming appointments only', async () => {
            const event = {
                pathParameters: {
                    userId: mockUserId,
                },
                queryStringParameters: {
                    upcoming: 'true',
                },
            };
            const result = await (0, get_appointments_1.handler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.appointments).toBeDefined();
        });
        it('should reject request without userId', async () => {
            const event = {
                pathParameters: null,
            };
            const result = await (0, get_appointments_1.handler)(event);
            expect(result.statusCode).toBe(400);
            const body = JSON.parse(result.body);
            expect(body.error).toContain('userId is required');
        });
    });
    describe('Update Appointment', () => {
        it('should update appointment status', async () => {
            const event = {
                pathParameters: {
                    userId: mockUserId,
                    appointmentId: mockAppointmentId,
                },
                body: JSON.stringify({
                    status: 'confirmed',
                }),
            };
            const result = await (0, update_appointment_1.handler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.message).toBe('Appointment updated successfully');
        });
        it('should reject invalid status', async () => {
            const event = {
                pathParameters: {
                    userId: mockUserId,
                    appointmentId: mockAppointmentId,
                },
                body: JSON.stringify({
                    status: 'invalid_status',
                }),
            };
            const result = await (0, update_appointment_1.handler)(event);
            expect(result.statusCode).toBe(400);
            const body = JSON.parse(result.body);
            expect(body.error).toContain('Invalid appointment status');
        });
    });
    describe('Delete Appointment', () => {
        it('should delete appointment', async () => {
            const event = {
                pathParameters: {
                    userId: mockUserId,
                    appointmentId: mockAppointmentId,
                },
            };
            const result = await (0, delete_appointment_1.handler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.message).toBe('Appointment deleted successfully');
        });
        it('should reject request without appointmentId', async () => {
            const event = {
                pathParameters: {
                    userId: mockUserId,
                },
            };
            const result = await (0, delete_appointment_1.handler)(event);
            expect(result.statusCode).toBe(400);
            const body = JSON.parse(result.body);
            expect(body.error).toContain('appointmentId are required');
        });
    });
    describe('Calendar Integration (iCal)', () => {
        it('should generate iCal for single appointment', async () => {
            const event = {
                pathParameters: {
                    userId: mockUserId,
                    appointmentId: mockAppointmentId,
                },
            };
            const result = await (0, get_appointment_ical_1.handler)(event);
            expect(result.statusCode).toBe(200);
            expect(result.headers?.['Content-Type']).toContain('text/calendar');
            expect(result.body).toContain('BEGIN:VCALENDAR');
            expect(result.body).toContain('END:VCALENDAR');
        });
        it('should generate iCal for all user appointments', async () => {
            const event = {
                pathParameters: {
                    userId: mockUserId,
                },
            };
            const result = await (0, get_appointment_ical_1.handler)(event);
            expect(result.statusCode).toBe(200);
            expect(result.headers?.['Content-Type']).toContain('text/calendar');
            expect(result.body).toContain('BEGIN:VCALENDAR');
        });
    });
    describe('Appointment Reminders', () => {
        it('should send reminders at 24 hours before appointment', () => {
            const scheduledTime = new Date(Date.now() + 24 * 60 * 60 * 1000);
            const checkTime = new Date();
            // This would be tested in the send-appointment-reminders Lambda
            expect(scheduledTime.getTime() - checkTime.getTime()).toBeGreaterThan(23 * 60 * 60 * 1000);
            expect(scheduledTime.getTime() - checkTime.getTime()).toBeLessThan(25 * 60 * 60 * 1000);
        });
        it('should send reminders at 2 hours before appointment', () => {
            const scheduledTime = new Date(Date.now() + 2 * 60 * 60 * 1000);
            const checkTime = new Date();
            expect(scheduledTime.getTime() - checkTime.getTime()).toBeGreaterThan(1 * 60 * 60 * 1000);
            expect(scheduledTime.getTime() - checkTime.getTime()).toBeLessThan(3 * 60 * 60 * 1000);
        });
    });
    describe('Missed Appointment Detection', () => {
        it('should detect missed appointment after scheduled time', () => {
            const scheduledTime = new Date(Date.now() - 2 * 60 * 60 * 1000); // 2 hours ago
            const checkTime = new Date();
            const duration = 30; // 30 minutes
            const appointmentEndTime = new Date(scheduledTime.getTime() + duration * 60 * 1000);
            const isMissed = checkTime > appointmentEndTime;
            expect(isMissed).toBe(true);
        });
        it('should not mark appointment as missed before scheduled time', () => {
            const scheduledTime = new Date(Date.now() + 2 * 60 * 60 * 1000); // 2 hours from now
            const checkTime = new Date();
            const duration = 30;
            const appointmentEndTime = new Date(scheduledTime.getTime() + duration * 60 * 1000);
            const isMissed = checkTime > appointmentEndTime;
            expect(isMissed).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwb2ludG1lbnQtbWFuYWdlbWVudC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwb2ludG1lbnQtbWFuYWdlbWVudC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwyQ0FBMkM7QUFDM0Msd0NBQXdDOztBQUl4Qyw2QkFBNkI7QUFDN0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsR0FBRyxtQkFBbUIsQ0FBQztBQUNyRCxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsR0FBRyxnQkFBZ0IsQ0FBQztBQUU5Qyx1QkFBdUI7QUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyw2QkFBNkIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzlDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ3JELElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDO0tBQ3RDLENBQUMsQ0FBQztJQUNILGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDNUIsQ0FBQyxDQUFDLENBQUM7QUFFSixJQUFJLENBQUMsSUFBSSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDeEQsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQztJQUMxRCxjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDO1FBQzFDLEVBQUUsRUFBRSxVQUFVO1FBQ2QsTUFBTSxFQUFFLFVBQVU7UUFDbEIsUUFBUSxFQUFFLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxhQUFhLEVBQUU7UUFDOUUsSUFBSSxFQUFFLFNBQVM7UUFDZixhQUFhLEVBQUUsSUFBSSxJQUFJ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QUFDLENBQUM7WUFDcEYsTUFBTSxRQUFRLEdBQUcsU0FBUyxHQUFHLGtCQUFrQixDQUFDO1lBRWhELE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUIsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkRBQTZELEVBQUUsR0FBRyxFQUFFO1lBQ3JFLE1BQU0sYUFBYSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLG1CQUFtQjtZQUNwRixNQUFNLFNBQVMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1lBQzdCLE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQztZQUVwQixNQUFNLGtCQUFrQixHQUFHLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsR0FBRyxRQUFRLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO1lBQ3BGLE1BQU0sUUFBUSxHQUFHLFNBQVMsR0FBRyxrQkFBa0IsQ0FBQztZQUVoRCxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEFwcG9pbnRtZW50IE1hbmFnZW1lbnQgSW50ZWdyYXRpb24gVGVzdHNcbi8vIFJlcXVpcmVtZW50czogNi4xLCA2LjIsIDYuMywgNi40LCA2LjVcblxuaW1wb3J0IHsgQVBJR2F0ZXdheVByb3h5RXZlbnQgfSBmcm9tICdhd3MtbGFtYmRhJztcblxuLy8gTW9jayBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbnByb2Nlc3MuZW52LkFQUE9JTlRNRU5UU19UQUJMRSA9ICd0ZXN0LWFwcG9pbnRtZW50cyc7XG5wcm9jZXNzLmVudi5FVkVOVF9CVVNfTkFNRSA9ICd0ZXN0LWV2ZW50LWJ1cyc7XG5cbi8vIE1vY2sgQVdTIFNESyBjbGllbnRzXG5qZXN0Lm1vY2soJ0Bhd3Mtc2RrL2NsaWVudC1ldmVudGJyaWRnZScsICgpID0+ICh7XG4gIEV2ZW50QnJpZGdlQ2xpZW50OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgc2VuZDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHt9KSxcbiAgfSkpLFxuICBQdXRFdmVudHNDb21tYW5kOiBqZXN0LmZuKCksXG59KSk7XG5cbmplc3QubW9jaygnLi4vLi4vc2hhcmVkL2RhdGEtYWNjZXNzL2FwcG9pbnRtZW50cycsICgpID0+ICh7XG4gIGNyZWF0ZUFwcG9pbnRtZW50OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJ2FwcHQtMTIzJyksXG4gIGdldEFwcG9pbnRtZW50OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgIGlkOiAnYXBwdC0xMjMnLFxuICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcbiAgICBwcm92aWRlcjogeyBuYW1lOiAnRHIuIFNtaXRoJywgc3BlY2lhbHR5OiAnQ2FyZGlvbG9neScsIHBob25lOiAnKzEyMzQ1Njc4OTAnIH0sXG4gICAgdHlwZTogJ2NoZWNrdXAnLFxuICAgIHNjaGVkdWxlZFRpbWU6IG5ldyBEYXRlKCksXG4gICAgc3RhdHVzOiAnc2NoZWR1bGVkJyxcbiAgICByZW1pbmRlcnM6IHsgZW5hYmxlZDogdHJ1ZSwgdGltZXM6IFsyNCwgMl0sIGNoYW5uZWxzOiBbJ3B1c2gnLCAnc21zJ10gfSxcbiAgfSksXG4gIGdldEFwcG9pbnRtZW50c0J5VXNlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFtdKSxcbiAgZ2V0VXBjb21pbmdBcHBvaW50bWVudHM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSksXG4gIHVwZGF0ZUFwcG9pbnRtZW50OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgdXBkYXRlQXBwb2ludG1lbnRTdGF0dXM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpLFxuICBkZWxldGVBcHBvaW50bWVudDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG59KSk7XG5cbmplc3QubW9jaygnLi4vLi4vc2hhcmVkL2RhdGEtYWNjZXNzL2NhcmUtY2lyY2xlJywgKCkgPT4gKHtcbiAgZ2V0Q2FyZUNpcmNsZU1lbWJlcnM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSksXG59KSk7XG5cbmltcG9ydCB7IGhhbmRsZXIgYXMgY3JlYXRlQXBwb2ludG1lbnRIYW5kbGVyIH0gZnJvbSAnLi4vY3JlYXRlLWFwcG9pbnRtZW50JztcbmltcG9ydCB7IGhhbmRsZXIgYXMgZ2V0QXBwb2ludG1lbnRzSGFuZGxlciB9IGZyb20gJy4uL2dldC1hcHBvaW50bWVudHMnO1xuaW1wb3J0IHsgaGFuZGxlciBhcyB1cGRhdGVBcHBvaW50bWVudEhhbmRsZXIgfSBmcm9tICcuLi91cGRhdGUtYXBwb2ludG1lbnQnO1xuaW1wb3J0IHsgaGFuZGxlciBhcyBkZWxldGVBcHBvaW50bWVudEhhbmRsZXIgfSBmcm9tICcuLi9kZWxldGUtYXBwb2ludG1lbnQnO1xuaW1wb3J0IHsgaGFuZGxlciBhcyBnZXRJQ2FsSGFuZGxlciB9IGZyb20gJy4uL2dldC1hcHBvaW50bWVudC1pY2FsJztcblxuZGVzY3JpYmUoJ0FwcG9pbnRtZW50IE1hbmFnZW1lbnQgSW50ZWdyYXRpb24gVGVzdHMnLCAoKSA9PiB7XG4gIGNvbnN0IG1vY2tVc2VySWQgPSAndXNlci0xMjMnO1xuICBjb25zdCBtb2NrQXBwb2ludG1lbnRJZCA9ICdhcHB0LTQ1Nic7XG5cbiAgZGVzY3JpYmUoJ0NyZWF0ZSBBcHBvaW50bWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhcHBvaW50bWVudCB3aXRoIHZhbGlkIGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudDogUGFydGlhbDxBUElHYXRld2F5UHJveHlFdmVudD4gPSB7XG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICB1c2VySWQ6IG1vY2tVc2VySWQsXG4gICAgICAgICAgcHJvdmlkZXI6IHtcbiAgICAgICAgICAgIG5hbWU6ICdEci4gU21pdGgnLFxuICAgICAgICAgICAgc3BlY2lhbHR5OiAnQ2FyZGlvbG9neScsXG4gICAgICAgICAgICBwaG9uZTogJysxMjM0NTY3ODkwJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHR5cGU6ICdjaGVja3VwJyxcbiAgICAgICAgICBzY2hlZHVsZWRUaW1lOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMjQgKiA2MCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBkdXJhdGlvbjogMzAsXG4gICAgICAgICAgbG9jYXRpb246ICcxMjMgTWVkaWNhbCBDZW50ZXInLFxuICAgICAgICAgIG5vdGVzOiAnQW5udWFsIGNoZWNrdXAnLFxuICAgICAgICB9KSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNyZWF0ZUFwcG9pbnRtZW50SGFuZGxlcihldmVudCBhcyBBUElHYXRld2F5UHJveHlFdmVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkuYXBwb2ludG1lbnRJZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChib2R5Lm1lc3NhZ2UpLnRvQmUoJ0FwcG9pbnRtZW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBhcHBvaW50bWVudCB3aXRoIG1pc3NpbmcgcmVxdWlyZWQgZmllbGRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQ6IFBhcnRpYWw8QVBJR2F0ZXdheVByb3h5RXZlbnQ+ID0ge1xuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgdXNlcklkOiBtb2NrVXNlcklkLFxuICAgICAgICAgIC8vIE1pc3NpbmcgcHJvdmlkZXIsIHR5cGUsIHNjaGVkdWxlZFRpbWVcbiAgICAgICAgfSksXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjcmVhdGVBcHBvaW50bWVudEhhbmRsZXIoZXZlbnQgYXMgQVBJR2F0ZXdheVByb3h5RXZlbnQpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoNDAwKTtcbiAgICAgIGNvbnN0IGJvZHkgPSBKU09OLnBhcnNlKHJlc3VsdC5ib2R5KTtcbiAgICAgIGV4cGVjdChib2R5LmVycm9yKS50b0NvbnRhaW4oJ01pc3NpbmcgcmVxdWlyZWQgZmllbGRzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBhcHBvaW50bWVudCB3aXRoIHBhc3Qgc2NoZWR1bGVkIHRpbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudDogUGFydGlhbDxBUElHYXRld2F5UHJveHlFdmVudD4gPSB7XG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICB1c2VySWQ6IG1vY2tVc2VySWQsXG4gICAgICAgICAgcHJvdmlkZXI6IHtcbiAgICAgICAgICAgIG5hbWU6ICdEci4gU21pdGgnLFxuICAgICAgICAgICAgc3BlY2lhbHR5OiAnQ2FyZGlvbG9neScsXG4gICAgICAgICAgICBwaG9uZTogJysxMjM0NTY3ODkwJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHR5cGU6ICdjaGVja3VwJyxcbiAgICAgICAgICBzY2hlZHVsZWRUaW1lOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMjQgKiA2MCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKSwgLy8gUGFzdCBkYXRlXG4gICAgICAgIH0pLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY3JlYXRlQXBwb2ludG1lbnRIYW5kbGVyKGV2ZW50IGFzIEFQSUdhdGV3YXlQcm94eUV2ZW50KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXNDb2RlKS50b0JlKDQwMCk7XG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5wYXJzZShyZXN1bHQuYm9keSk7XG4gICAgICBleHBlY3QoYm9keS5lcnJvcikudG9Db250YWluKCdtdXN0IGJlIGluIHRoZSBmdXR1cmUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGFwcG9pbnRtZW50IHdpdGggaW52YWxpZCB0eXBlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQ6IFBhcnRpYWw8QVBJR2F0ZXdheVByb3h5RXZlbnQ+ID0ge1xuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgdXNlcklkOiBtb2NrVXNlcklkLFxuICAgICAgICAgIHByb3ZpZGVyOiB7XG4gICAgICAgICAgICBuYW1lOiAnRHIuIFNtaXRoJyxcbiAgICAgICAgICAgIHNwZWNpYWx0eTogJ0NhcmRpb2xvZ3knLFxuICAgICAgICAgICAgcGhvbmU6ICcrMTIzNDU2Nzg5MCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB0eXBlOiAnaW52YWxpZF90eXBlJyxcbiAgICAgICAgICBzY2hlZHVsZWRUaW1lOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMjQgKiA2MCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgfSksXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjcmVhdGVBcHBvaW50bWVudEhhbmRsZXIoZXZlbnQgYXMgQVBJR2F0ZXdheVByb3h5RXZlbnQpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoNDAwKTtcbiAgICAgIGNvbnN0IGJvZHkgPSBKU09OLnBhcnNlKHJlc3VsdC5ib2R5KTtcbiAgICAgIGV4cGVjdChib2R5LmVycm9yKS50b0NvbnRhaW4oJ0ludmFsaWQgYXBwb2ludG1lbnQgdHlwZScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR2V0IEFwcG9pbnRtZW50cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBhbGwgYXBwb2ludG1lbnRzIGZvciB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQ6IFBhcnRpYWw8QVBJR2F0ZXdheVByb3h5RXZlbnQ+ID0ge1xuICAgICAgICBwYXRoUGFyYW1ldGVyczoge1xuICAgICAgICAgIHVzZXJJZDogbW9ja1VzZXJJZCxcbiAgICAgICAgfSxcbiAgICAgICAgcXVlcnlTdHJpbmdQYXJhbWV0ZXJzOiBudWxsLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0QXBwb2ludG1lbnRzSGFuZGxlcihldmVudCBhcyBBUElHYXRld2F5UHJveHlFdmVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkuYXBwb2ludG1lbnRzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkoYm9keS5hcHBvaW50bWVudHMpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgdXBjb21pbmcgYXBwb2ludG1lbnRzIG9ubHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudDogUGFydGlhbDxBUElHYXRld2F5UHJveHlFdmVudD4gPSB7XG4gICAgICAgIHBhdGhQYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgdXNlcklkOiBtb2NrVXNlcklkLFxuICAgICAgICB9LFxuICAgICAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnM6IHtcbiAgICAgICAgICB1cGNvbWluZzogJ3RydWUnLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0QXBwb2ludG1lbnRzSGFuZGxlcihldmVudCBhcyBBUElHYXRld2F5UHJveHlFdmVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkuYXBwb2ludG1lbnRzKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcmVxdWVzdCB3aXRob3V0IHVzZXJJZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50OiBQYXJ0aWFsPEFQSUdhdGV3YXlQcm94eUV2ZW50PiA9IHtcbiAgICAgICAgcGF0aFBhcmFtZXRlcnM6IG51bGwsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRBcHBvaW50bWVudHNIYW5kbGVyKGV2ZW50IGFzIEFQSUdhdGV3YXlQcm94eUV2ZW50KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXNDb2RlKS50b0JlKDQwMCk7XG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5wYXJzZShyZXN1bHQuYm9keSk7XG4gICAgICBleHBlY3QoYm9keS5lcnJvcikudG9Db250YWluKCd1c2VySWQgaXMgcmVxdWlyZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1VwZGF0ZSBBcHBvaW50bWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBhcHBvaW50bWVudCBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudDogUGFydGlhbDxBUElHYXRld2F5UHJveHlFdmVudD4gPSB7XG4gICAgICAgIHBhdGhQYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgdXNlcklkOiBtb2NrVXNlcklkLFxuICAgICAgICAgIGFwcG9pbnRtZW50SWQ6IG1vY2tBcHBvaW50bWVudElkLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgc3RhdHVzOiAnY29uZmlybWVkJyxcbiAgICAgICAgfSksXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGRhdGVBcHBvaW50bWVudEhhbmRsZXIoZXZlbnQgYXMgQVBJR2F0ZXdheVByb3h5RXZlbnQpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoMjAwKTtcbiAgICAgIGNvbnN0IGJvZHkgPSBKU09OLnBhcnNlKHJlc3VsdC5ib2R5KTtcbiAgICAgIGV4cGVjdChib2R5Lm1lc3NhZ2UpLnRvQmUoJ0FwcG9pbnRtZW50IHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBpbnZhbGlkIHN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50OiBQYXJ0aWFsPEFQSUdhdGV3YXlQcm94eUV2ZW50PiA9IHtcbiAgICAgICAgcGF0aFBhcmFtZXRlcnM6IHtcbiAgICAgICAgICB1c2VySWQ6IG1vY2tVc2VySWQsXG4gICAgICAgICAgYXBwb2ludG1lbnRJZDogbW9ja0FwcG9pbnRtZW50SWQsXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBzdGF0dXM6ICdpbnZhbGlkX3N0YXR1cycsXG4gICAgICAgIH0pLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXBkYXRlQXBwb2ludG1lbnRIYW5kbGVyKGV2ZW50IGFzIEFQSUdhdGV3YXlQcm94eUV2ZW50KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXNDb2RlKS50b0JlKDQwMCk7XG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5wYXJzZShyZXN1bHQuYm9keSk7XG4gICAgICBleHBlY3QoYm9keS5lcnJvcikudG9Db250YWluKCdJbnZhbGlkIGFwcG9pbnRtZW50IHN0YXR1cycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGVsZXRlIEFwcG9pbnRtZW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZGVsZXRlIGFwcG9pbnRtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQ6IFBhcnRpYWw8QVBJR2F0ZXdheVByb3h5RXZlbnQ+ID0ge1xuICAgICAgICBwYXRoUGFyYW1ldGVyczoge1xuICAgICAgICAgIHVzZXJJZDogbW9ja1VzZXJJZCxcbiAgICAgICAgICBhcHBvaW50bWVudElkOiBtb2NrQXBwb2ludG1lbnRJZCxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRlbGV0ZUFwcG9pbnRtZW50SGFuZGxlcihldmVudCBhcyBBUElHYXRld2F5UHJveHlFdmVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkubWVzc2FnZSkudG9CZSgnQXBwb2ludG1lbnQgZGVsZXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHJlcXVlc3Qgd2l0aG91dCBhcHBvaW50bWVudElkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQ6IFBhcnRpYWw8QVBJR2F0ZXdheVByb3h5RXZlbnQ+ID0ge1xuICAgICAgICBwYXRoUGFyYW1ldGVyczoge1xuICAgICAgICAgIHVzZXJJZDogbW9ja1VzZXJJZCxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRlbGV0ZUFwcG9pbnRtZW50SGFuZGxlcihldmVudCBhcyBBUElHYXRld2F5UHJveHlFdmVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSg0MDApO1xuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkuZXJyb3IpLnRvQ29udGFpbignYXBwb2ludG1lbnRJZCBhcmUgcmVxdWlyZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NhbGVuZGFyIEludGVncmF0aW9uIChpQ2FsKScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIGlDYWwgZm9yIHNpbmdsZSBhcHBvaW50bWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50OiBQYXJ0aWFsPEFQSUdhdGV3YXlQcm94eUV2ZW50PiA9IHtcbiAgICAgICAgcGF0aFBhcmFtZXRlcnM6IHtcbiAgICAgICAgICB1c2VySWQ6IG1vY2tVc2VySWQsXG4gICAgICAgICAgYXBwb2ludG1lbnRJZDogbW9ja0FwcG9pbnRtZW50SWQsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRJQ2FsSGFuZGxlcihldmVudCBhcyBBUElHYXRld2F5UHJveHlFdmVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5oZWFkZXJzPy5bJ0NvbnRlbnQtVHlwZSddKS50b0NvbnRhaW4oJ3RleHQvY2FsZW5kYXInKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYm9keSkudG9Db250YWluKCdCRUdJTjpWQ0FMRU5EQVInKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYm9keSkudG9Db250YWluKCdFTkQ6VkNBTEVOREFSJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIGlDYWwgZm9yIGFsbCB1c2VyIGFwcG9pbnRtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50OiBQYXJ0aWFsPEFQSUdhdGV3YXlQcm94eUV2ZW50PiA9IHtcbiAgICAgICAgcGF0aFBhcmFtZXRlcnM6IHtcbiAgICAgICAgICB1c2VySWQ6IG1vY2tVc2VySWQsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRJQ2FsSGFuZGxlcihldmVudCBhcyBBUElHYXRld2F5UHJveHlFdmVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5oZWFkZXJzPy5bJ0NvbnRlbnQtVHlwZSddKS50b0NvbnRhaW4oJ3RleHQvY2FsZW5kYXInKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYm9keSkudG9Db250YWluKCdCRUdJTjpWQ0FMRU5EQVInKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FwcG9pbnRtZW50IFJlbWluZGVycycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNlbmQgcmVtaW5kZXJzIGF0IDI0IGhvdXJzIGJlZm9yZSBhcHBvaW50bWVudCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHNjaGVkdWxlZFRpbWUgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgMjQgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICBjb25zdCBjaGVja1RpbWUgPSBuZXcgRGF0ZSgpO1xuICAgICAgXG4gICAgICAvLyBUaGlzIHdvdWxkIGJlIHRlc3RlZCBpbiB0aGUgc2VuZC1hcHBvaW50bWVudC1yZW1pbmRlcnMgTGFtYmRhXG4gICAgICBleHBlY3Qoc2NoZWR1bGVkVGltZS5nZXRUaW1lKCkgLSBjaGVja1RpbWUuZ2V0VGltZSgpKS50b0JlR3JlYXRlclRoYW4oMjMgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICBleHBlY3Qoc2NoZWR1bGVkVGltZS5nZXRUaW1lKCkgLSBjaGVja1RpbWUuZ2V0VGltZSgpKS50b0JlTGVzc1RoYW4oMjUgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNlbmQgcmVtaW5kZXJzIGF0IDIgaG91cnMgYmVmb3JlIGFwcG9pbnRtZW50JywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2NoZWR1bGVkVGltZSA9IG5ldyBEYXRlKERhdGUubm93KCkgKyAyICogNjAgKiA2MCAqIDEwMDApO1xuICAgICAgY29uc3QgY2hlY2tUaW1lID0gbmV3IERhdGUoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHNjaGVkdWxlZFRpbWUuZ2V0VGltZSgpIC0gY2hlY2tUaW1lLmdldFRpbWUoKSkudG9CZUdyZWF0ZXJUaGFuKDEgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICBleHBlY3Qoc2NoZWR1bGVkVGltZS5nZXRUaW1lKCkgLSBjaGVja1RpbWUuZ2V0VGltZSgpKS50b0JlTGVzc1RoYW4oMyAqIDYwICogNjAgKiAxMDAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ01pc3NlZCBBcHBvaW50bWVudCBEZXRlY3Rpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgbWlzc2VkIGFwcG9pbnRtZW50IGFmdGVyIHNjaGVkdWxlZCB0aW1lJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2NoZWR1bGVkVGltZSA9IG5ldyBEYXRlKERhdGUubm93KCkgLSAyICogNjAgKiA2MCAqIDEwMDApOyAvLyAyIGhvdXJzIGFnb1xuICAgICAgY29uc3QgY2hlY2tUaW1lID0gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gMzA7IC8vIDMwIG1pbnV0ZXNcbiAgICAgIFxuICAgICAgY29uc3QgYXBwb2ludG1lbnRFbmRUaW1lID0gbmV3IERhdGUoc2NoZWR1bGVkVGltZS5nZXRUaW1lKCkgKyBkdXJhdGlvbiAqIDYwICogMTAwMCk7XG4gICAgICBjb25zdCBpc01pc3NlZCA9IGNoZWNrVGltZSA+IGFwcG9pbnRtZW50RW5kVGltZTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGlzTWlzc2VkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgbWFyayBhcHBvaW50bWVudCBhcyBtaXNzZWQgYmVmb3JlIHNjaGVkdWxlZCB0aW1lJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2NoZWR1bGVkVGltZSA9IG5ldyBEYXRlKERhdGUubm93KCkgKyAyICogNjAgKiA2MCAqIDEwMDApOyAvLyAyIGhvdXJzIGZyb20gbm93XG4gICAgICBjb25zdCBjaGVja1RpbWUgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSAzMDtcbiAgICAgIFxuICAgICAgY29uc3QgYXBwb2ludG1lbnRFbmRUaW1lID0gbmV3IERhdGUoc2NoZWR1bGVkVGltZS5nZXRUaW1lKCkgKyBkdXJhdGlvbiAqIDYwICogMTAwMCk7XG4gICAgICBjb25zdCBpc01pc3NlZCA9IGNoZWNrVGltZSA+IGFwcG9pbnRtZW50RW5kVGltZTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGlzTWlzc2VkKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==