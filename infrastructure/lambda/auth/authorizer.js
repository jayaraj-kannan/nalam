"use strict";
// API Gateway Authorizer Lambda Function
// Requirements: 8.4, 8.5 - Authorization and permission system with audit logging
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = handler;
const aws_jwt_verify_1 = require("aws-jwt-verify");
const audit_logger_1 = require("../shared/audit-logger");
// Environment variables
const PRIMARY_USER_POOL_ID = process.env.PRIMARY_USER_POOL_ID;
const SECONDARY_USER_POOL_ID = process.env.SECONDARY_USER_POOL_ID;
const PRIMARY_CLIENT_ID = process.env.PRIMARY_CLIENT_ID;
const SECONDARY_CLIENT_ID = process.env.SECONDARY_CLIENT_ID;
// JWT Verifiers for both user pools
const primaryVerifier = aws_jwt_verify_1.CognitoJwtVerifier.create({
    userPoolId: PRIMARY_USER_POOL_ID,
    tokenUse: 'access',
    clientId: PRIMARY_CLIENT_ID,
});
const secondaryVerifier = aws_jwt_verify_1.CognitoJwtVerifier.create({
    userPoolId: SECONDARY_USER_POOL_ID,
    tokenUse: 'access',
    clientId: SECONDARY_CLIENT_ID,
});
async function handler(event) {
    try {
        const token = event.authorizationToken.replace('Bearer ', '');
        // Try to verify with primary user pool first
        let payload = null;
        let userType = 'primary';
        try {
            payload = await primaryVerifier.verify(token);
            userType = 'primary';
        }
        catch (primaryError) {
            // If primary verification fails, try secondary
            try {
                payload = await secondaryVerifier.verify(token);
                userType = 'secondary';
            }
            catch (secondaryError) {
                console.error('Token verification failed for both user pools', {
                    primaryError,
                    secondaryError,
                });
                throw new Error('Unauthorized');
            }
        }
        if (!payload) {
            throw new Error('Unauthorized');
        }
        const userId = payload.sub;
        const email = payload.email;
        // Log authentication event for audit trail (Requirement 8.4)
        await (0, audit_logger_1.logAuditEvent)({
            eventType: 'AUTHENTICATION',
            userId,
            userType,
            email,
            resource: event.methodArn,
            timestamp: new Date().toISOString(),
            success: true,
            ipAddress: event.requestContext?.identity?.sourceIp,
            userAgent: event.requestContext?.identity?.userAgent,
        });
        // Generate IAM policy
        const policy = generatePolicy(userId, 'Allow', event.methodArn, {
            userType,
            email,
            groups: payload['cognito:groups'] || [],
        });
        return policy;
    }
    catch (error) {
        console.error('Authorization error:', error);
        // Log failed authentication attempt
        await (0, audit_logger_1.logAuditEvent)({
            eventType: 'AUTHENTICATION_FAILED',
            userId: 'unknown',
            userType: 'unknown',
            resource: event.methodArn,
            timestamp: new Date().toISOString(),
            success: false,
            ipAddress: event.requestContext?.identity?.sourceIp,
            userAgent: event.requestContext?.identity?.userAgent,
            errorMessage: error instanceof Error ? error.message : 'Unknown error',
        });
        throw new Error('Unauthorized');
    }
}
function generatePolicy(principalId, effect, resource, context) {
    return {
        principalId,
        policyDocument: {
            Version: '2012-10-17',
            Statement: [
                {
                    Action: 'execute-api:Invoke',
                    Effect: effect,
                    Resource: resource,
                },
            ],
        },
        context: {
            ...context,
            // Convert arrays and objects to strings for context
            userType: String(context.userType),
            email: String(context.email),
            groups: JSON.stringify(context.groups),
        },
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aG9yaXplci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImF1dGhvcml6ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHlDQUF5QztBQUN6QyxrRkFBa0Y7O0FBZ0NsRiwwQkF5RUM7QUF0R0QsbURBQW9EO0FBQ3BELHlEQUF1RDtBQUV2RCx3QkFBd0I7QUFDeEIsTUFBTSxvQkFBb0IsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFxQixDQUFDO0FBQy9ELE1BQU0sc0JBQXNCLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBdUIsQ0FBQztBQUNuRSxNQUFNLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWtCLENBQUM7QUFDekQsTUFBTSxtQkFBbUIsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFvQixDQUFDO0FBRTdELG9DQUFvQztBQUNwQyxNQUFNLGVBQWUsR0FBRyxtQ0FBa0IsQ0FBQyxNQUFNLENBQUM7SUFDaEQsVUFBVSxFQUFFLG9CQUFvQjtJQUNoQyxRQUFRLEVBQUUsUUFBUTtJQUNsQixRQUFRLEVBQUUsaUJBQWlCO0NBQzVCLENBQUMsQ0FBQztBQUVILE1BQU0saUJBQWlCLEdBQUcsbUNBQWtCLENBQUMsTUFBTSxDQUFDO0lBQ2xELFVBQVUsRUFBRSxzQkFBc0I7SUFDbEMsUUFBUSxFQUFFLFFBQVE7SUFDbEIsUUFBUSxFQUFFLG1CQUFtQjtDQUM5QixDQUFDLENBQUM7QUFTSSxLQUFLLFVBQVUsT0FBTyxDQUMzQixLQUFxQztJQUVyQyxJQUFJLENBQUM7UUFDSCxNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUU5RCw2Q0FBNkM7UUFDN0MsSUFBSSxPQUFPLEdBQXdCLElBQUksQ0FBQztRQUN4QyxJQUFJLFFBQVEsR0FBNEIsU0FBUyxDQUFDO1FBRWxELElBQUksQ0FBQztZQUNILE9BQU8sR0FBRyxNQUFNLGVBQWUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFpQixDQUFDO1lBQzlELFFBQVEsR0FBRyxTQUFTLENBQUM7UUFDdkIsQ0FBQztRQUFDLE9BQU8sWUFBWSxFQUFFLENBQUM7WUFDdEIsK0NBQStDO1lBQy9DLElBQUksQ0FBQztnQkFDSCxPQUFPLEdBQUcsTUFBTSxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFpQixDQUFDO2dCQUNoRSxRQUFRLEdBQUcsV0FBVyxDQUFDO1lBQ3pCLENBQUM7WUFBQyxPQUFPLGNBQWMsRUFBRSxDQUFDO2dCQUN4QixPQUFPLENBQUMsS0FBSyxDQUFDLCtDQUErQyxFQUFFO29CQUM3RCxZQUFZO29CQUNaLGNBQWM7aUJBQ2YsQ0FBQyxDQUFDO2dCQUNILE1BQU0sSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7WUFDbEMsQ0FBQztRQUNILENBQUM7UUFFRCxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDYixNQUFNLElBQUksS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ2xDLENBQUM7UUFFRCxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO1FBQzNCLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7UUFFNUIsNkRBQTZEO1FBQzdELE1BQU0sSUFBQSw0QkFBYSxFQUFDO1lBQ2xCLFNBQVMsRUFBRSxnQkFBZ0I7WUFDM0IsTUFBTTtZQUNOLFFBQVE7WUFDUixLQUFLO1lBQ0wsUUFBUSxFQUFFLEtBQUssQ0FBQyxTQUFTO1lBQ3pCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtZQUNuQyxPQUFPLEVBQUUsSUFBSTtZQUNiLFNBQVMsRUFBRSxLQUFLLENBQUMsY0FBYyxFQUFFLFFBQVEsRUFBRSxRQUFRO1lBQ25ELFNBQVMsRUFBRSxLQUFLLENBQUMsY0FBYyxFQUFFLFFBQVEsRUFBRSxTQUFTO1NBQ3JELENBQUMsQ0FBQztRQUVILHNCQUFzQjtRQUN0QixNQUFNLE1BQU0sR0FBRyxjQUFjLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsU0FBUyxFQUFFO1lBQzlELFFBQVE7WUFDUixLQUFLO1lBQ0wsTUFBTSxFQUFFLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUU7U0FDeEMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFzQixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRTdDLG9DQUFvQztRQUNwQyxNQUFNLElBQUEsNEJBQWEsRUFBQztZQUNsQixTQUFTLEVBQUUsdUJBQXVCO1lBQ2xDLE1BQU0sRUFBRSxTQUFTO1lBQ2pCLFFBQVEsRUFBRSxTQUFTO1lBQ25CLFFBQVEsRUFBRSxLQUFLLENBQUMsU0FBUztZQUN6QixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7WUFDbkMsT0FBTyxFQUFFLEtBQUs7WUFDZCxTQUFTLEVBQUUsS0FBSyxDQUFDLGNBQWMsRUFBRSxRQUFRLEVBQUUsUUFBUTtZQUNuRCxTQUFTLEVBQUUsS0FBSyxDQUFDLGNBQWMsRUFBRSxRQUFRLEVBQUUsU0FBUztZQUNwRCxZQUFZLEVBQUUsS0FBSyxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsZUFBZTtTQUN2RSxDQUFDLENBQUM7UUFFSCxNQUFNLElBQUksS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7QUFDSCxDQUFDO0FBRUQsU0FBUyxjQUFjLENBQ3JCLFdBQW1CLEVBQ25CLE1BQXdCLEVBQ3hCLFFBQWdCLEVBQ2hCLE9BQWdDO0lBRWhDLE9BQU87UUFDTCxXQUFXO1FBQ1gsY0FBYyxFQUFFO1lBQ2QsT0FBTyxFQUFFLFlBQVk7WUFDckIsU0FBUyxFQUFFO2dCQUNUO29CQUNFLE1BQU0sRUFBRSxvQkFBb0I7b0JBQzVCLE1BQU0sRUFBRSxNQUFNO29CQUNkLFFBQVEsRUFBRSxRQUFRO2lCQUNuQjthQUNGO1NBQ0Y7UUFDRCxPQUFPLEVBQUU7WUFDUCxHQUFHLE9BQU87WUFDVixvREFBb0Q7WUFDcEQsUUFBUSxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO1lBQ2xDLEtBQUssRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztZQUM1QixNQUFNLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO1NBQ3ZDO0tBQ0YsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBBUEkgR2F0ZXdheSBBdXRob3JpemVyIExhbWJkYSBGdW5jdGlvblxuLy8gUmVxdWlyZW1lbnRzOiA4LjQsIDguNSAtIEF1dGhvcml6YXRpb24gYW5kIHBlcm1pc3Npb24gc3lzdGVtIHdpdGggYXVkaXQgbG9nZ2luZ1xuXG5pbXBvcnQgeyBBUElHYXRld2F5QXV0aG9yaXplclJlc3VsdCwgQVBJR2F0ZXdheVRva2VuQXV0aG9yaXplckV2ZW50IH0gZnJvbSAnYXdzLWxhbWJkYSc7XG5pbXBvcnQgeyBDb2duaXRvSnd0VmVyaWZpZXIgfSBmcm9tICdhd3Mtand0LXZlcmlmeSc7XG5pbXBvcnQgeyBsb2dBdWRpdEV2ZW50IH0gZnJvbSAnLi4vc2hhcmVkL2F1ZGl0LWxvZ2dlcic7XG5cbi8vIEVudmlyb25tZW50IHZhcmlhYmxlc1xuY29uc3QgUFJJTUFSWV9VU0VSX1BPT0xfSUQgPSBwcm9jZXNzLmVudi5QUklNQVJZX1VTRVJfUE9PTF9JRCE7XG5jb25zdCBTRUNPTkRBUllfVVNFUl9QT09MX0lEID0gcHJvY2Vzcy5lbnYuU0VDT05EQVJZX1VTRVJfUE9PTF9JRCE7XG5jb25zdCBQUklNQVJZX0NMSUVOVF9JRCA9IHByb2Nlc3MuZW52LlBSSU1BUllfQ0xJRU5UX0lEITtcbmNvbnN0IFNFQ09OREFSWV9DTElFTlRfSUQgPSBwcm9jZXNzLmVudi5TRUNPTkRBUllfQ0xJRU5UX0lEITtcblxuLy8gSldUIFZlcmlmaWVycyBmb3IgYm90aCB1c2VyIHBvb2xzXG5jb25zdCBwcmltYXJ5VmVyaWZpZXIgPSBDb2duaXRvSnd0VmVyaWZpZXIuY3JlYXRlKHtcbiAgdXNlclBvb2xJZDogUFJJTUFSWV9VU0VSX1BPT0xfSUQsXG4gIHRva2VuVXNlOiAnYWNjZXNzJyxcbiAgY2xpZW50SWQ6IFBSSU1BUllfQ0xJRU5UX0lELFxufSk7XG5cbmNvbnN0IHNlY29uZGFyeVZlcmlmaWVyID0gQ29nbml0b0p3dFZlcmlmaWVyLmNyZWF0ZSh7XG4gIHVzZXJQb29sSWQ6IFNFQ09OREFSWV9VU0VSX1BPT0xfSUQsXG4gIHRva2VuVXNlOiAnYWNjZXNzJyxcbiAgY2xpZW50SWQ6IFNFQ09OREFSWV9DTElFTlRfSUQsXG59KTtcblxuaW50ZXJmYWNlIFRva2VuUGF5bG9hZCB7XG4gIHN1Yjogc3RyaW5nO1xuICBlbWFpbDogc3RyaW5nO1xuICAnY29nbml0bzpncm91cHMnPzogc3RyaW5nW107XG4gICdjdXN0b206dXNlclR5cGUnPzogJ3ByaW1hcnknIHwgJ3NlY29uZGFyeSc7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKFxuICBldmVudDogQVBJR2F0ZXdheVRva2VuQXV0aG9yaXplckV2ZW50XG4pOiBQcm9taXNlPEFQSUdhdGV3YXlBdXRob3JpemVyUmVzdWx0PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdG9rZW4gPSBldmVudC5hdXRob3JpemF0aW9uVG9rZW4ucmVwbGFjZSgnQmVhcmVyICcsICcnKTtcbiAgICBcbiAgICAvLyBUcnkgdG8gdmVyaWZ5IHdpdGggcHJpbWFyeSB1c2VyIHBvb2wgZmlyc3RcbiAgICBsZXQgcGF5bG9hZDogVG9rZW5QYXlsb2FkIHwgbnVsbCA9IG51bGw7XG4gICAgbGV0IHVzZXJUeXBlOiAncHJpbWFyeScgfCAnc2Vjb25kYXJ5JyA9ICdwcmltYXJ5JztcbiAgICBcbiAgICB0cnkge1xuICAgICAgcGF5bG9hZCA9IGF3YWl0IHByaW1hcnlWZXJpZmllci52ZXJpZnkodG9rZW4pIGFzIFRva2VuUGF5bG9hZDtcbiAgICAgIHVzZXJUeXBlID0gJ3ByaW1hcnknO1xuICAgIH0gY2F0Y2ggKHByaW1hcnlFcnJvcikge1xuICAgICAgLy8gSWYgcHJpbWFyeSB2ZXJpZmljYXRpb24gZmFpbHMsIHRyeSBzZWNvbmRhcnlcbiAgICAgIHRyeSB7XG4gICAgICAgIHBheWxvYWQgPSBhd2FpdCBzZWNvbmRhcnlWZXJpZmllci52ZXJpZnkodG9rZW4pIGFzIFRva2VuUGF5bG9hZDtcbiAgICAgICAgdXNlclR5cGUgPSAnc2Vjb25kYXJ5JztcbiAgICAgIH0gY2F0Y2ggKHNlY29uZGFyeUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Rva2VuIHZlcmlmaWNhdGlvbiBmYWlsZWQgZm9yIGJvdGggdXNlciBwb29scycsIHtcbiAgICAgICAgICBwcmltYXJ5RXJyb3IsXG4gICAgICAgICAgc2Vjb25kYXJ5RXJyb3IsXG4gICAgICAgIH0pO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuYXV0aG9yaXplZCcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghcGF5bG9hZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmF1dGhvcml6ZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCB1c2VySWQgPSBwYXlsb2FkLnN1YjtcbiAgICBjb25zdCBlbWFpbCA9IHBheWxvYWQuZW1haWw7XG5cbiAgICAvLyBMb2cgYXV0aGVudGljYXRpb24gZXZlbnQgZm9yIGF1ZGl0IHRyYWlsIChSZXF1aXJlbWVudCA4LjQpXG4gICAgYXdhaXQgbG9nQXVkaXRFdmVudCh7XG4gICAgICBldmVudFR5cGU6ICdBVVRIRU5USUNBVElPTicsXG4gICAgICB1c2VySWQsXG4gICAgICB1c2VyVHlwZSxcbiAgICAgIGVtYWlsLFxuICAgICAgcmVzb3VyY2U6IGV2ZW50Lm1ldGhvZEFybixcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGlwQWRkcmVzczogZXZlbnQucmVxdWVzdENvbnRleHQ/LmlkZW50aXR5Py5zb3VyY2VJcCxcbiAgICAgIHVzZXJBZ2VudDogZXZlbnQucmVxdWVzdENvbnRleHQ/LmlkZW50aXR5Py51c2VyQWdlbnQsXG4gICAgfSk7XG5cbiAgICAvLyBHZW5lcmF0ZSBJQU0gcG9saWN5XG4gICAgY29uc3QgcG9saWN5ID0gZ2VuZXJhdGVQb2xpY3kodXNlcklkLCAnQWxsb3cnLCBldmVudC5tZXRob2RBcm4sIHtcbiAgICAgIHVzZXJUeXBlLFxuICAgICAgZW1haWwsXG4gICAgICBncm91cHM6IHBheWxvYWRbJ2NvZ25pdG86Z3JvdXBzJ10gfHwgW10sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gcG9saWN5O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0F1dGhvcml6YXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgIFxuICAgIC8vIExvZyBmYWlsZWQgYXV0aGVudGljYXRpb24gYXR0ZW1wdFxuICAgIGF3YWl0IGxvZ0F1ZGl0RXZlbnQoe1xuICAgICAgZXZlbnRUeXBlOiAnQVVUSEVOVElDQVRJT05fRkFJTEVEJyxcbiAgICAgIHVzZXJJZDogJ3Vua25vd24nLFxuICAgICAgdXNlclR5cGU6ICd1bmtub3duJyxcbiAgICAgIHJlc291cmNlOiBldmVudC5tZXRob2RBcm4sXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgaXBBZGRyZXNzOiBldmVudC5yZXF1ZXN0Q29udGV4dD8uaWRlbnRpdHk/LnNvdXJjZUlwLFxuICAgICAgdXNlckFnZW50OiBldmVudC5yZXF1ZXN0Q29udGV4dD8uaWRlbnRpdHk/LnVzZXJBZ2VudCxcbiAgICAgIGVycm9yTWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgfSk7XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuYXV0aG9yaXplZCcpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlUG9saWN5KFxuICBwcmluY2lwYWxJZDogc3RyaW5nLFxuICBlZmZlY3Q6ICdBbGxvdycgfCAnRGVueScsXG4gIHJlc291cmNlOiBzdHJpbmcsXG4gIGNvbnRleHQ6IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4pOiBBUElHYXRld2F5QXV0aG9yaXplclJlc3VsdCB7XG4gIHJldHVybiB7XG4gICAgcHJpbmNpcGFsSWQsXG4gICAgcG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgIFZlcnNpb246ICcyMDEyLTEwLTE3JyxcbiAgICAgIFN0YXRlbWVudDogW1xuICAgICAgICB7XG4gICAgICAgICAgQWN0aW9uOiAnZXhlY3V0ZS1hcGk6SW52b2tlJyxcbiAgICAgICAgICBFZmZlY3Q6IGVmZmVjdCxcbiAgICAgICAgICBSZXNvdXJjZTogcmVzb3VyY2UsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0sXG4gICAgY29udGV4dDoge1xuICAgICAgLi4uY29udGV4dCxcbiAgICAgIC8vIENvbnZlcnQgYXJyYXlzIGFuZCBvYmplY3RzIHRvIHN0cmluZ3MgZm9yIGNvbnRleHRcbiAgICAgIHVzZXJUeXBlOiBTdHJpbmcoY29udGV4dC51c2VyVHlwZSksXG4gICAgICBlbWFpbDogU3RyaW5nKGNvbnRleHQuZW1haWwpLFxuICAgICAgZ3JvdXBzOiBKU09OLnN0cmluZ2lmeShjb250ZXh0Lmdyb3VwcyksXG4gICAgfSxcbiAgfTtcbn1cbiJdfQ==