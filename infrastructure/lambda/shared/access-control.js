"use strict";
// Access Control Logic for Health Data Sharing
// Requirements: 8.4, 8.5 - Permission-based access control with audit logging
Object.defineProperty(exports, "__esModule", { value: true });
exports.LIMITED_ACCESS_PERMISSIONS = exports.FULL_ACCESS_PERMISSIONS = exports.DEFAULT_PERMISSIONS = exports.PERMISSION_MATRIX = void 0;
exports.checkPermission = checkPermission;
exports.checkMultiplePermissions = checkMultiplePermissions;
exports.verifyCareCircleMembership = verifyCareCircleMembership;
exports.getEffectivePermissions = getEffectivePermissions;
exports.filterDataByPermissions = filterDataByPermissions;
exports.checkWriteAccess = checkWriteAccess;
const care_circle_1 = require("./data-access/care-circle");
const audit_logger_1 = require("./audit-logger");
/**
 * Permission Matrix - Maps data types to required permissions
 * Requirements: 8.4, 8.5 - Granular permission control
 */
exports.PERMISSION_MATRIX = {
    vitals: 'canViewVitals',
    medications: 'canViewMedications',
    appointments: 'canViewAppointments',
    healthRecords: 'canViewHealthRecords',
    alerts: 'canReceiveAlerts',
    messages: 'canSendMessages',
    devices: 'canManageDevices',
};
/**
 * Check if a user has permission to access specific data
 * Requirements: 8.4, 8.5 - Verify permissions before data access
 */
async function checkPermission(requestingUserId, requestingUserType, targetUserId, dataType, action = 'read') {
    try {
        // Primary users always have full access to their own data
        if (requestingUserType === 'primary' && requestingUserId === targetUserId) {
            await (0, audit_logger_1.logDataAccess)(requestingUserId, requestingUserType, targetUserId, dataType, action, true, ['self-access'], { reason: 'Primary user accessing own data' });
            return true;
        }
        // Secondary users need explicit permissions
        if (requestingUserType === 'secondary') {
            const careCircleMember = await (0, care_circle_1.getCareCircleMember)(targetUserId, requestingUserId);
            if (!careCircleMember) {
                await (0, audit_logger_1.logDataAccess)(requestingUserId, requestingUserType, targetUserId, dataType, action, false, ['care-circle-membership'], { reason: 'Not a care circle member' });
                return false;
            }
            const requiredPermission = exports.PERMISSION_MATRIX[dataType];
            const hasPermission = careCircleMember.permissions[requiredPermission];
            await (0, audit_logger_1.logDataAccess)(requestingUserId, requestingUserType, targetUserId, dataType, action, hasPermission, [requiredPermission], {
                relationship: careCircleMember.relationship,
                allPermissions: careCircleMember.permissions,
            });
            return hasPermission;
        }
        // Primary users cannot access other primary users' data
        await (0, audit_logger_1.logDataAccess)(requestingUserId, requestingUserType, targetUserId, dataType, action, false, ['cross-user-access'], { reason: 'Primary user attempting to access another user\'s data' });
        return false;
    }
    catch (error) {
        console.error('Permission check error:', error);
        await (0, audit_logger_1.logDataAccess)(requestingUserId, requestingUserType, targetUserId, dataType, action, false, ['error'], { error: error instanceof Error ? error.message : 'Unknown error' });
        return false;
    }
}
/**
 * Check multiple permissions at once
 * Requirements: 8.4, 8.5 - Efficient permission checking
 */
async function checkMultiplePermissions(requestingUserId, requestingUserType, targetUserId, dataTypes, action = 'read') {
    const results = {};
    for (const dataType of dataTypes) {
        results[dataType] = await checkPermission(requestingUserId, requestingUserType, targetUserId, dataType, action);
    }
    return results;
}
/**
 * Verify care circle membership
 * Requirements: 8.4, 8.5 - Validate care circle relationships
 */
async function verifyCareCircleMembership(secondaryUserId, primaryUserId) {
    try {
        const member = await (0, care_circle_1.getCareCircleMember)(primaryUserId, secondaryUserId);
        const isMember = member !== null;
        await (0, audit_logger_1.logCareCircleAccess)(secondaryUserId, primaryUserId, 'verify-membership', isMember, ['care-circle-membership'], { isMember });
        return isMember;
    }
    catch (error) {
        console.error('Care circle membership verification error:', error);
        await (0, audit_logger_1.logCareCircleAccess)(secondaryUserId, primaryUserId, 'verify-membership', false, ['error'], { error: error instanceof Error ? error.message : 'Unknown error' });
        return false;
    }
}
/**
 * Get effective permissions for a care circle member
 * Requirements: 8.4, 8.5 - Retrieve permission set
 */
async function getEffectivePermissions(secondaryUserId, primaryUserId) {
    try {
        const member = await (0, care_circle_1.getCareCircleMember)(primaryUserId, secondaryUserId);
        if (!member) {
            await (0, audit_logger_1.logCareCircleAccess)(secondaryUserId, primaryUserId, 'get-permissions', false, ['care-circle-membership'], { reason: 'Not a care circle member' });
            return null;
        }
        await (0, audit_logger_1.logCareCircleAccess)(secondaryUserId, primaryUserId, 'get-permissions', true, Object.keys(member.permissions), { permissions: member.permissions });
        return member.permissions;
    }
    catch (error) {
        console.error('Get effective permissions error:', error);
        await (0, audit_logger_1.logCareCircleAccess)(secondaryUserId, primaryUserId, 'get-permissions', false, ['error'], { error: error instanceof Error ? error.message : 'Unknown error' });
        return null;
    }
}
/**
 * Filter data based on permissions
 * Requirements: 8.5 - Selective data sharing
 */
function filterDataByPermissions(data, permissions, dataTypeMap) {
    const filtered = {};
    for (const [key, value] of Object.entries(data)) {
        const dataType = dataTypeMap[key];
        if (!dataType) {
            // If no data type mapping, include by default
            filtered[key] = value;
            continue;
        }
        const requiredPermission = exports.PERMISSION_MATRIX[dataType];
        if (permissions[requiredPermission]) {
            filtered[key] = value;
        }
    }
    return filtered;
}
/**
 * Validate write access
 * Requirements: 8.4, 8.5 - Restrict write operations
 */
async function checkWriteAccess(requestingUserId, requestingUserType, targetUserId, dataType) {
    // Only primary users can write their own data
    // Secondary users have read-only access
    if (requestingUserType === 'primary' && requestingUserId === targetUserId) {
        await (0, audit_logger_1.logDataAccess)(requestingUserId, requestingUserType, targetUserId, dataType, 'write', true, ['self-write'], { reason: 'Primary user writing own data' });
        return true;
    }
    await (0, audit_logger_1.logDataAccess)(requestingUserId, requestingUserType, targetUserId, dataType, 'write', false, ['write-access'], { reason: 'Write access denied' });
    return false;
}
/**
 * Default permission set for new care circle members
 * Requirements: 8.5 - Default permissions
 */
exports.DEFAULT_PERMISSIONS = {
    canViewVitals: true,
    canViewMedications: true,
    canViewAppointments: true,
    canViewHealthRecords: false, // Sensitive, opt-in
    canReceiveAlerts: true,
    canSendMessages: true,
    canManageDevices: false, // Restricted
};
/**
 * Full access permission set (for close family members)
 * Requirements: 8.5 - Permission presets
 */
exports.FULL_ACCESS_PERMISSIONS = {
    canViewVitals: true,
    canViewMedications: true,
    canViewAppointments: true,
    canViewHealthRecords: true,
    canReceiveAlerts: true,
    canSendMessages: true,
    canManageDevices: true,
};
/**
 * Limited access permission set (for distant relatives or friends)
 * Requirements: 8.5 - Permission presets
 */
exports.LIMITED_ACCESS_PERMISSIONS = {
    canViewVitals: false,
    canViewMedications: false,
    canViewAppointments: true,
    canViewHealthRecords: false,
    canReceiveAlerts: false,
    canSendMessages: true,
    canManageDevices: false,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjZXNzLWNvbnRyb2wuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhY2Nlc3MtY29udHJvbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsK0NBQStDO0FBQy9DLDhFQUE4RTs7O0FBMkI5RSwwQ0F1RkM7QUFNRCw0REFvQkM7QUFNRCxnRUE4QkM7QUFNRCwwREF5Q0M7QUFNRCwwREF1QkM7QUFNRCw0Q0FpQ0M7QUFoU0QsMkRBQWdFO0FBQ2hFLGlEQUFvRTtBQUVwRTs7O0dBR0c7QUFDVSxRQUFBLGlCQUFpQixHQUFHO0lBQy9CLE1BQU0sRUFBRSxlQUFlO0lBQ3ZCLFdBQVcsRUFBRSxvQkFBb0I7SUFDakMsWUFBWSxFQUFFLHFCQUFxQjtJQUNuQyxhQUFhLEVBQUUsc0JBQXNCO0lBQ3JDLE1BQU0sRUFBRSxrQkFBa0I7SUFDMUIsUUFBUSxFQUFFLGlCQUFpQjtJQUMzQixPQUFPLEVBQUUsa0JBQWtCO0NBQ25CLENBQUM7QUFLWDs7O0dBR0c7QUFDSSxLQUFLLFVBQVUsZUFBZSxDQUNuQyxnQkFBd0IsRUFDeEIsa0JBQTJDLEVBQzNDLFlBQW9CLEVBQ3BCLFFBQWtCLEVBQ2xCLFNBQXNDLE1BQU07SUFFNUMsSUFBSSxDQUFDO1FBQ0gsMERBQTBEO1FBQzFELElBQUksa0JBQWtCLEtBQUssU0FBUyxJQUFJLGdCQUFnQixLQUFLLFlBQVksRUFBRSxDQUFDO1lBQzFFLE1BQU0sSUFBQSw0QkFBYSxFQUNqQixnQkFBZ0IsRUFDaEIsa0JBQWtCLEVBQ2xCLFlBQVksRUFDWixRQUFRLEVBQ1IsTUFBTSxFQUNOLElBQUksRUFDSixDQUFDLGFBQWEsQ0FBQyxFQUNmLEVBQUUsTUFBTSxFQUFFLGlDQUFpQyxFQUFFLENBQzlDLENBQUM7WUFDRixPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFFRCw0Q0FBNEM7UUFDNUMsSUFBSSxrQkFBa0IsS0FBSyxXQUFXLEVBQUUsQ0FBQztZQUN2QyxNQUFNLGdCQUFnQixHQUFHLE1BQU0sSUFBQSxpQ0FB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RSxJQUFJO0lBQ3pCLG9CQUFvQixFQUFFLEtBQUs7SUFDM0IsZ0JBQWdCLEVBQUUsS0FBSztJQUN2QixlQUFlLEVBQUUsSUFBSTtJQUNyQixnQkFBZ0IsRUFBRSxLQUFLO0NBQ3hCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBBY2Nlc3MgQ29udHJvbCBMb2dpYyBmb3IgSGVhbHRoIERhdGEgU2hhcmluZ1xuLy8gUmVxdWlyZW1lbnRzOiA4LjQsIDguNSAtIFBlcm1pc3Npb24tYmFzZWQgYWNjZXNzIGNvbnRyb2wgd2l0aCBhdWRpdCBsb2dnaW5nXG5cbmltcG9ydCB7IFBlcm1pc3Npb25TZXQgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IGdldENhcmVDaXJjbGVNZW1iZXIgfSBmcm9tICcuL2RhdGEtYWNjZXNzL2NhcmUtY2lyY2xlJztcbmltcG9ydCB7IGxvZ0RhdGFBY2Nlc3MsIGxvZ0NhcmVDaXJjbGVBY2Nlc3MgfSBmcm9tICcuL2F1ZGl0LWxvZ2dlcic7XG5cbi8qKlxuICogUGVybWlzc2lvbiBNYXRyaXggLSBNYXBzIGRhdGEgdHlwZXMgdG8gcmVxdWlyZWQgcGVybWlzc2lvbnNcbiAqIFJlcXVpcmVtZW50czogOC40LCA4LjUgLSBHcmFudWxhciBwZXJtaXNzaW9uIGNvbnRyb2xcbiAqL1xuZXhwb3J0IGNvbnN0IFBFUk1JU1NJT05fTUFUUklYID0ge1xuICB2aXRhbHM6ICdjYW5WaWV3Vml0YWxzJyxcbiAgbWVkaWNhdGlvbnM6ICdjYW5WaWV3TWVkaWNhdGlvbnMnLFxuICBhcHBvaW50bWVudHM6ICdjYW5WaWV3QXBwb2ludG1lbnRzJyxcbiAgaGVhbHRoUmVjb3JkczogJ2NhblZpZXdIZWFsdGhSZWNvcmRzJyxcbiAgYWxlcnRzOiAnY2FuUmVjZWl2ZUFsZXJ0cycsXG4gIG1lc3NhZ2VzOiAnY2FuU2VuZE1lc3NhZ2VzJyxcbiAgZGV2aWNlczogJ2Nhbk1hbmFnZURldmljZXMnLFxufSBhcyBjb25zdDtcblxuZXhwb3J0IHR5cGUgRGF0YVR5cGUgPSBrZXlvZiB0eXBlb2YgUEVSTUlTU0lPTl9NQVRSSVg7XG5leHBvcnQgdHlwZSBQZXJtaXNzaW9uS2V5ID0gdHlwZW9mIFBFUk1JU1NJT05fTUFUUklYW0RhdGFUeXBlXTtcblxuLyoqXG4gKiBDaGVjayBpZiBhIHVzZXIgaGFzIHBlcm1pc3Npb24gdG8gYWNjZXNzIHNwZWNpZmljIGRhdGFcbiAqIFJlcXVpcmVtZW50czogOC40LCA4LjUgLSBWZXJpZnkgcGVybWlzc2lvbnMgYmVmb3JlIGRhdGEgYWNjZXNzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1Blcm1pc3Npb24oXG4gIHJlcXVlc3RpbmdVc2VySWQ6IHN0cmluZyxcbiAgcmVxdWVzdGluZ1VzZXJUeXBlOiAncHJpbWFyeScgfCAnc2Vjb25kYXJ5JyxcbiAgdGFyZ2V0VXNlcklkOiBzdHJpbmcsXG4gIGRhdGFUeXBlOiBEYXRhVHlwZSxcbiAgYWN0aW9uOiAncmVhZCcgfCAnd3JpdGUnIHwgJ2RlbGV0ZScgPSAncmVhZCdcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICB0cnkge1xuICAgIC8vIFByaW1hcnkgdXNlcnMgYWx3YXlzIGhhdmUgZnVsbCBhY2Nlc3MgdG8gdGhlaXIgb3duIGRhdGFcbiAgICBpZiAocmVxdWVzdGluZ1VzZXJUeXBlID09PSAncHJpbWFyeScgJiYgcmVxdWVzdGluZ1VzZXJJZCA9PT0gdGFyZ2V0VXNlcklkKSB7XG4gICAgICBhd2FpdCBsb2dEYXRhQWNjZXNzKFxuICAgICAgICByZXF1ZXN0aW5nVXNlcklkLFxuICAgICAgICByZXF1ZXN0aW5nVXNlclR5cGUsXG4gICAgICAgIHRhcmdldFVzZXJJZCxcbiAgICAgICAgZGF0YVR5cGUsXG4gICAgICAgIGFjdGlvbixcbiAgICAgICAgdHJ1ZSxcbiAgICAgICAgWydzZWxmLWFjY2VzcyddLFxuICAgICAgICB7IHJlYXNvbjogJ1ByaW1hcnkgdXNlciBhY2Nlc3Npbmcgb3duIGRhdGEnIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBTZWNvbmRhcnkgdXNlcnMgbmVlZCBleHBsaWNpdCBwZXJtaXNzaW9uc1xuICAgIGlmIChyZXF1ZXN0aW5nVXNlclR5cGUgPT09ICdzZWNvbmRhcnknKSB7XG4gICAgICBjb25zdCBjYXJlQ2lyY2xlTWVtYmVyID0gYXdhaXQgZ2V0Q2FyZUNpcmNsZU1lbWJlcih0YXJnZXRVc2VySWQsIHJlcXVlc3RpbmdVc2VySWQpO1xuICAgICAgXG4gICAgICBpZiAoIWNhcmVDaXJjbGVNZW1iZXIpIHtcbiAgICAgICAgYXdhaXQgbG9nRGF0YUFjY2VzcyhcbiAgICAgICAgICByZXF1ZXN0aW5nVXNlcklkLFxuICAgICAgICAgIHJlcXVlc3RpbmdVc2VyVHlwZSxcbiAgICAgICAgICB0YXJnZXRVc2VySWQsXG4gICAgICAgICAgZGF0YVR5cGUsXG4gICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIFsnY2FyZS1jaXJjbGUtbWVtYmVyc2hpcCddLFxuICAgICAgICAgIHsgcmVhc29uOiAnTm90IGEgY2FyZSBjaXJjbGUgbWVtYmVyJyB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVxdWlyZWRQZXJtaXNzaW9uID0gUEVSTUlTU0lPTl9NQVRSSVhbZGF0YVR5cGVdO1xuICAgICAgY29uc3QgaGFzUGVybWlzc2lvbiA9IGNhcmVDaXJjbGVNZW1iZXIucGVybWlzc2lvbnNbcmVxdWlyZWRQZXJtaXNzaW9uIGFzIGtleW9mIFBlcm1pc3Npb25TZXRdO1xuXG4gICAgICBhd2FpdCBsb2dEYXRhQWNjZXNzKFxuICAgICAgICByZXF1ZXN0aW5nVXNlcklkLFxuICAgICAgICByZXF1ZXN0aW5nVXNlclR5cGUsXG4gICAgICAgIHRhcmdldFVzZXJJZCxcbiAgICAgICAgZGF0YVR5cGUsXG4gICAgICAgIGFjdGlvbixcbiAgICAgICAgaGFzUGVybWlzc2lvbixcbiAgICAgICAgW3JlcXVpcmVkUGVybWlzc2lvbl0sXG4gICAgICAgIHtcbiAgICAgICAgICByZWxhdGlvbnNoaXA6IGNhcmVDaXJjbGVNZW1iZXIucmVsYXRpb25zaGlwLFxuICAgICAgICAgIGFsbFBlcm1pc3Npb25zOiBjYXJlQ2lyY2xlTWVtYmVyLnBlcm1pc3Npb25zLFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICByZXR1cm4gaGFzUGVybWlzc2lvbjtcbiAgICB9XG5cbiAgICAvLyBQcmltYXJ5IHVzZXJzIGNhbm5vdCBhY2Nlc3Mgb3RoZXIgcHJpbWFyeSB1c2VycycgZGF0YVxuICAgIGF3YWl0IGxvZ0RhdGFBY2Nlc3MoXG4gICAgICByZXF1ZXN0aW5nVXNlcklkLFxuICAgICAgcmVxdWVzdGluZ1VzZXJUeXBlLFxuICAgICAgdGFyZ2V0VXNlcklkLFxuICAgICAgZGF0YVR5cGUsXG4gICAgICBhY3Rpb24sXG4gICAgICBmYWxzZSxcbiAgICAgIFsnY3Jvc3MtdXNlci1hY2Nlc3MnXSxcbiAgICAgIHsgcmVhc29uOiAnUHJpbWFyeSB1c2VyIGF0dGVtcHRpbmcgdG8gYWNjZXNzIGFub3RoZXIgdXNlclxcJ3MgZGF0YScgfVxuICAgICk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1Blcm1pc3Npb24gY2hlY2sgZXJyb3I6JywgZXJyb3IpO1xuICAgIGF3YWl0IGxvZ0RhdGFBY2Nlc3MoXG4gICAgICByZXF1ZXN0aW5nVXNlcklkLFxuICAgICAgcmVxdWVzdGluZ1VzZXJUeXBlLFxuICAgICAgdGFyZ2V0VXNlcklkLFxuICAgICAgZGF0YVR5cGUsXG4gICAgICBhY3Rpb24sXG4gICAgICBmYWxzZSxcbiAgICAgIFsnZXJyb3InXSxcbiAgICAgIHsgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InIH1cbiAgICApO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIENoZWNrIG11bHRpcGxlIHBlcm1pc3Npb25zIGF0IG9uY2VcbiAqIFJlcXVpcmVtZW50czogOC40LCA4LjUgLSBFZmZpY2llbnQgcGVybWlzc2lvbiBjaGVja2luZ1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tNdWx0aXBsZVBlcm1pc3Npb25zKFxuICByZXF1ZXN0aW5nVXNlcklkOiBzdHJpbmcsXG4gIHJlcXVlc3RpbmdVc2VyVHlwZTogJ3ByaW1hcnknIHwgJ3NlY29uZGFyeScsXG4gIHRhcmdldFVzZXJJZDogc3RyaW5nLFxuICBkYXRhVHlwZXM6IERhdGFUeXBlW10sXG4gIGFjdGlvbjogJ3JlYWQnIHwgJ3dyaXRlJyB8ICdkZWxldGUnID0gJ3JlYWQnXG4pOiBQcm9taXNlPFJlY29yZDxEYXRhVHlwZSwgYm9vbGVhbj4+IHtcbiAgY29uc3QgcmVzdWx0czogUGFydGlhbDxSZWNvcmQ8RGF0YVR5cGUsIGJvb2xlYW4+PiA9IHt9O1xuICBcbiAgZm9yIChjb25zdCBkYXRhVHlwZSBvZiBkYXRhVHlwZXMpIHtcbiAgICByZXN1bHRzW2RhdGFUeXBlXSA9IGF3YWl0IGNoZWNrUGVybWlzc2lvbihcbiAgICAgIHJlcXVlc3RpbmdVc2VySWQsXG4gICAgICByZXF1ZXN0aW5nVXNlclR5cGUsXG4gICAgICB0YXJnZXRVc2VySWQsXG4gICAgICBkYXRhVHlwZSxcbiAgICAgIGFjdGlvblxuICAgICk7XG4gIH1cbiAgXG4gIHJldHVybiByZXN1bHRzIGFzIFJlY29yZDxEYXRhVHlwZSwgYm9vbGVhbj47XG59XG5cbi8qKlxuICogVmVyaWZ5IGNhcmUgY2lyY2xlIG1lbWJlcnNoaXBcbiAqIFJlcXVpcmVtZW50czogOC40LCA4LjUgLSBWYWxpZGF0ZSBjYXJlIGNpcmNsZSByZWxhdGlvbnNoaXBzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlDYXJlQ2lyY2xlTWVtYmVyc2hpcChcbiAgc2Vjb25kYXJ5VXNlcklkOiBzdHJpbmcsXG4gIHByaW1hcnlVc2VySWQ6IHN0cmluZ1xuKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgbWVtYmVyID0gYXdhaXQgZ2V0Q2FyZUNpcmNsZU1lbWJlcihwcmltYXJ5VXNlcklkLCBzZWNvbmRhcnlVc2VySWQpO1xuICAgIGNvbnN0IGlzTWVtYmVyID0gbWVtYmVyICE9PSBudWxsO1xuXG4gICAgYXdhaXQgbG9nQ2FyZUNpcmNsZUFjY2VzcyhcbiAgICAgIHNlY29uZGFyeVVzZXJJZCxcbiAgICAgIHByaW1hcnlVc2VySWQsXG4gICAgICAndmVyaWZ5LW1lbWJlcnNoaXAnLFxuICAgICAgaXNNZW1iZXIsXG4gICAgICBbJ2NhcmUtY2lyY2xlLW1lbWJlcnNoaXAnXSxcbiAgICAgIHsgaXNNZW1iZXIgfVxuICAgICk7XG5cbiAgICByZXR1cm4gaXNNZW1iZXI7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignQ2FyZSBjaXJjbGUgbWVtYmVyc2hpcCB2ZXJpZmljYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgIGF3YWl0IGxvZ0NhcmVDaXJjbGVBY2Nlc3MoXG4gICAgICBzZWNvbmRhcnlVc2VySWQsXG4gICAgICBwcmltYXJ5VXNlcklkLFxuICAgICAgJ3ZlcmlmeS1tZW1iZXJzaGlwJyxcbiAgICAgIGZhbHNlLFxuICAgICAgWydlcnJvciddLFxuICAgICAgeyBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicgfVxuICAgICk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICogR2V0IGVmZmVjdGl2ZSBwZXJtaXNzaW9ucyBmb3IgYSBjYXJlIGNpcmNsZSBtZW1iZXJcbiAqIFJlcXVpcmVtZW50czogOC40LCA4LjUgLSBSZXRyaWV2ZSBwZXJtaXNzaW9uIHNldFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0RWZmZWN0aXZlUGVybWlzc2lvbnMoXG4gIHNlY29uZGFyeVVzZXJJZDogc3RyaW5nLFxuICBwcmltYXJ5VXNlcklkOiBzdHJpbmdcbik6IFByb21pc2U8UGVybWlzc2lvblNldCB8IG51bGw+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBtZW1iZXIgPSBhd2FpdCBnZXRDYXJlQ2lyY2xlTWVtYmVyKHByaW1hcnlVc2VySWQsIHNlY29uZGFyeVVzZXJJZCk7XG4gICAgXG4gICAgaWYgKCFtZW1iZXIpIHtcbiAgICAgIGF3YWl0IGxvZ0NhcmVDaXJjbGVBY2Nlc3MoXG4gICAgICAgIHNlY29uZGFyeVVzZXJJZCxcbiAgICAgICAgcHJpbWFyeVVzZXJJZCxcbiAgICAgICAgJ2dldC1wZXJtaXNzaW9ucycsXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBbJ2NhcmUtY2lyY2xlLW1lbWJlcnNoaXAnXSxcbiAgICAgICAgeyByZWFzb246ICdOb3QgYSBjYXJlIGNpcmNsZSBtZW1iZXInIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBhd2FpdCBsb2dDYXJlQ2lyY2xlQWNjZXNzKFxuICAgICAgc2Vjb25kYXJ5VXNlcklkLFxuICAgICAgcHJpbWFyeVVzZXJJZCxcbiAgICAgICdnZXQtcGVybWlzc2lvbnMnLFxuICAgICAgdHJ1ZSxcbiAgICAgIE9iamVjdC5rZXlzKG1lbWJlci5wZXJtaXNzaW9ucyksXG4gICAgICB7IHBlcm1pc3Npb25zOiBtZW1iZXIucGVybWlzc2lvbnMgfVxuICAgICk7XG5cbiAgICByZXR1cm4gbWVtYmVyLnBlcm1pc3Npb25zO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0dldCBlZmZlY3RpdmUgcGVybWlzc2lvbnMgZXJyb3I6JywgZXJyb3IpO1xuICAgIGF3YWl0IGxvZ0NhcmVDaXJjbGVBY2Nlc3MoXG4gICAgICBzZWNvbmRhcnlVc2VySWQsXG4gICAgICBwcmltYXJ5VXNlcklkLFxuICAgICAgJ2dldC1wZXJtaXNzaW9ucycsXG4gICAgICBmYWxzZSxcbiAgICAgIFsnZXJyb3InXSxcbiAgICAgIHsgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InIH1cbiAgICApO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8qKlxuICogRmlsdGVyIGRhdGEgYmFzZWQgb24gcGVybWlzc2lvbnNcbiAqIFJlcXVpcmVtZW50czogOC41IC0gU2VsZWN0aXZlIGRhdGEgc2hhcmluZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyRGF0YUJ5UGVybWlzc2lvbnM8VCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+PihcbiAgZGF0YTogVCxcbiAgcGVybWlzc2lvbnM6IFBlcm1pc3Npb25TZXQsXG4gIGRhdGFUeXBlTWFwOiBQYXJ0aWFsPFJlY29yZDxrZXlvZiBULCBEYXRhVHlwZT4+XG4pOiBQYXJ0aWFsPFQ+IHtcbiAgY29uc3QgZmlsdGVyZWQ6IFBhcnRpYWw8VD4gPSB7fTtcblxuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhkYXRhKSkge1xuICAgIGNvbnN0IGRhdGFUeXBlID0gZGF0YVR5cGVNYXBba2V5IGFzIGtleW9mIFRdO1xuICAgIFxuICAgIGlmICghZGF0YVR5cGUpIHtcbiAgICAgIC8vIElmIG5vIGRhdGEgdHlwZSBtYXBwaW5nLCBpbmNsdWRlIGJ5IGRlZmF1bHRcbiAgICAgIGZpbHRlcmVkW2tleSBhcyBrZXlvZiBUXSA9IHZhbHVlIGFzIFRba2V5b2YgVF07XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCByZXF1aXJlZFBlcm1pc3Npb24gPSBQRVJNSVNTSU9OX01BVFJJWFtkYXRhVHlwZV07XG4gICAgaWYgKHBlcm1pc3Npb25zW3JlcXVpcmVkUGVybWlzc2lvbiBhcyBrZXlvZiBQZXJtaXNzaW9uU2V0XSkge1xuICAgICAgZmlsdGVyZWRba2V5IGFzIGtleW9mIFRdID0gdmFsdWUgYXMgVFtrZXlvZiBUXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmlsdGVyZWQ7XG59XG5cbi8qKlxuICogVmFsaWRhdGUgd3JpdGUgYWNjZXNzXG4gKiBSZXF1aXJlbWVudHM6IDguNCwgOC41IC0gUmVzdHJpY3Qgd3JpdGUgb3BlcmF0aW9uc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tXcml0ZUFjY2VzcyhcbiAgcmVxdWVzdGluZ1VzZXJJZDogc3RyaW5nLFxuICByZXF1ZXN0aW5nVXNlclR5cGU6ICdwcmltYXJ5JyB8ICdzZWNvbmRhcnknLFxuICB0YXJnZXRVc2VySWQ6IHN0cmluZyxcbiAgZGF0YVR5cGU6IERhdGFUeXBlXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgLy8gT25seSBwcmltYXJ5IHVzZXJzIGNhbiB3cml0ZSB0aGVpciBvd24gZGF0YVxuICAvLyBTZWNvbmRhcnkgdXNlcnMgaGF2ZSByZWFkLW9ubHkgYWNjZXNzXG4gIGlmIChyZXF1ZXN0aW5nVXNlclR5cGUgPT09ICdwcmltYXJ5JyAmJiByZXF1ZXN0aW5nVXNlcklkID09PSB0YXJnZXRVc2VySWQpIHtcbiAgICBhd2FpdCBsb2dEYXRhQWNjZXNzKFxuICAgICAgcmVxdWVzdGluZ1VzZXJJZCxcbiAgICAgIHJlcXVlc3RpbmdVc2VyVHlwZSxcbiAgICAgIHRhcmdldFVzZXJJZCxcbiAgICAgIGRhdGFUeXBlLFxuICAgICAgJ3dyaXRlJyxcbiAgICAgIHRydWUsXG4gICAgICBbJ3NlbGYtd3JpdGUnXSxcbiAgICAgIHsgcmVhc29uOiAnUHJpbWFyeSB1c2VyIHdyaXRpbmcgb3duIGRhdGEnIH1cbiAgICApO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgYXdhaXQgbG9nRGF0YUFjY2VzcyhcbiAgICByZXF1ZXN0aW5nVXNlcklkLFxuICAgIHJlcXVlc3RpbmdVc2VyVHlwZSxcbiAgICB0YXJnZXRVc2VySWQsXG4gICAgZGF0YVR5cGUsXG4gICAgJ3dyaXRlJyxcbiAgICBmYWxzZSxcbiAgICBbJ3dyaXRlLWFjY2VzcyddLFxuICAgIHsgcmVhc29uOiAnV3JpdGUgYWNjZXNzIGRlbmllZCcgfVxuICApO1xuICByZXR1cm4gZmFsc2U7XG59XG5cbi8qKlxuICogRGVmYXVsdCBwZXJtaXNzaW9uIHNldCBmb3IgbmV3IGNhcmUgY2lyY2xlIG1lbWJlcnNcbiAqIFJlcXVpcmVtZW50czogOC41IC0gRGVmYXVsdCBwZXJtaXNzaW9uc1xuICovXG5leHBvcnQgY29uc3QgREVGQVVMVF9QRVJNSVNTSU9OUzogUGVybWlzc2lvblNldCA9IHtcbiAgY2FuVmlld1ZpdGFsczogdHJ1ZSxcbiAgY2FuVmlld01lZGljYXRpb25zOiB0cnVlLFxuICBjYW5WaWV3QXBwb2ludG1lbnRzOiB0cnVlLFxuICBjYW5WaWV3SGVhbHRoUmVjb3JkczogZmFsc2UsIC8vIFNlbnNpdGl2ZSwgb3B0LWluXG4gIGNhblJlY2VpdmVBbGVydHM6IHRydWUsXG4gIGNhblNlbmRNZXNzYWdlczogdHJ1ZSxcbiAgY2FuTWFuYWdlRGV2aWNlczogZmFsc2UsIC8vIFJlc3RyaWN0ZWRcbn07XG5cbi8qKlxuICogRnVsbCBhY2Nlc3MgcGVybWlzc2lvbiBzZXQgKGZvciBjbG9zZSBmYW1pbHkgbWVtYmVycylcbiAqIFJlcXVpcmVtZW50czogOC41IC0gUGVybWlzc2lvbiBwcmVzZXRzXG4gKi9cbmV4cG9ydCBjb25zdCBGVUxMX0FDQ0VTU19QRVJNSVNTSU9OUzogUGVybWlzc2lvblNldCA9IHtcbiAgY2FuVmlld1ZpdGFsczogdHJ1ZSxcbiAgY2FuVmlld01lZGljYXRpb25zOiB0cnVlLFxuICBjYW5WaWV3QXBwb2ludG1lbnRzOiB0cnVlLFxuICBjYW5WaWV3SGVhbHRoUmVjb3JkczogdHJ1ZSxcbiAgY2FuUmVjZWl2ZUFsZXJ0czogdHJ1ZSxcbiAgY2FuU2VuZE1lc3NhZ2VzOiB0cnVlLFxuICBjYW5NYW5hZ2VEZXZpY2VzOiB0cnVlLFxufTtcblxuLyoqXG4gKiBMaW1pdGVkIGFjY2VzcyBwZXJtaXNzaW9uIHNldCAoZm9yIGRpc3RhbnQgcmVsYXRpdmVzIG9yIGZyaWVuZHMpXG4gKiBSZXF1aXJlbWVudHM6IDguNSAtIFBlcm1pc3Npb24gcHJlc2V0c1xuICovXG5leHBvcnQgY29uc3QgTElNSVRFRF9BQ0NFU1NfUEVSTUlTU0lPTlM6IFBlcm1pc3Npb25TZXQgPSB7XG4gIGNhblZpZXdWaXRhbHM6IGZhbHNlLFxuICBjYW5WaWV3TWVkaWNhdGlvbnM6IGZhbHNlLFxuICBjYW5WaWV3QXBwb2ludG1lbnRzOiB0cnVlLFxuICBjYW5WaWV3SGVhbHRoUmVjb3JkczogZmFsc2UsXG4gIGNhblJlY2VpdmVBbGVydHM6IGZhbHNlLFxuICBjYW5TZW5kTWVzc2FnZXM6IHRydWUsXG4gIGNhbk1hbmFnZURldmljZXM6IGZhbHNlLFxufTtcbiJdfQ==