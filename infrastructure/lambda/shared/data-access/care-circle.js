"use strict";
// Care Circle Table Data Access Layer
// Requirements: 4.1, 8.1, 8.4, 8.5
Object.defineProperty(exports, "__esModule", { value: true });
exports.addCareCircleMember = addCareCircleMember;
exports.getCareCircleMember = getCareCircleMember;
exports.getCareCircleMembers = getCareCircleMembers;
exports.updateCareCirclePermissions = updateCareCirclePermissions;
exports.updateCareCircleRelationship = updateCareCircleRelationship;
exports.updateCareCircleLastActive = updateCareCircleLastActive;
exports.removeCareCircleMember = removeCareCircleMember;
exports.checkPermission = checkPermission;
const dynamodb_client_1 = require("../dynamodb-client");
async function addCareCircleMember(primaryUserId, secondaryUserId, relationship, permissions) {
    await (0, dynamodb_client_1.putItem)(dynamodb_client_1.TABLES.CARE_CIRCLE, {
        primaryUserId,
        secondaryUserId,
        relationship,
        permissions,
        joinedAt: new Date().toISOString(),
        lastActive: new Date().toISOString(),
    });
}
async function getCareCircleMember(primaryUserId, secondaryUserId) {
    return await (0, dynamodb_client_1.getItem)(dynamodb_client_1.TABLES.CARE_CIRCLE, {
        primaryUserId,
        secondaryUserId,
    });
}
async function getCareCircleMembers(primaryUserId) {
    return await (0, dynamodb_client_1.queryItems)(dynamodb_client_1.TABLES.CARE_CIRCLE, 'primaryUserId = :primaryUserId', { ':primaryUserId': primaryUserId });
}
async function updateCareCirclePermissions(primaryUserId, secondaryUserId, permissions) {
    await (0, dynamodb_client_1.updateItem)(dynamodb_client_1.TABLES.CARE_CIRCLE, { primaryUserId, secondaryUserId }, 'SET permissions = :permissions, lastActive = :lastActive', {
        ':permissions': permissions,
        ':lastActive': new Date().toISOString(),
    });
}
async function updateCareCircleRelationship(primaryUserId, secondaryUserId, relationship) {
    await (0, dynamodb_client_1.updateItem)(dynamodb_client_1.TABLES.CARE_CIRCLE, { primaryUserId, secondaryUserId }, 'SET relationship = :relationship, lastActive = :lastActive', {
        ':relationship': relationship,
        ':lastActive': new Date().toISOString(),
    });
}
async function updateCareCircleLastActive(primaryUserId, secondaryUserId) {
    await (0, dynamodb_client_1.updateItem)(dynamodb_client_1.TABLES.CARE_CIRCLE, { primaryUserId, secondaryUserId }, 'SET lastActive = :lastActive', { ':lastActive': new Date().toISOString() });
}
async function removeCareCircleMember(primaryUserId, secondaryUserId) {
    await (0, dynamodb_client_1.deleteItem)(dynamodb_client_1.TABLES.CARE_CIRCLE, { primaryUserId, secondaryUserId });
}
async function checkPermission(primaryUserId, secondaryUserId, permission) {
    const member = await getCareCircleMember(primaryUserId, secondaryUserId);
    return member?.permissions[permission] || false;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FyZS1jaXJjbGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjYXJlLWNpcmNsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsc0NBQXNDO0FBQ3RDLG1DQUFtQzs7QUFrQm5DLGtEQWNDO0FBRUQsa0RBUUM7QUFFRCxvREFRQztBQUVELGtFQWNDO0FBRUQsb0VBY0M7QUFFRCxnRUFVQztBQUVELHdEQUtDO0FBRUQsMENBT0M7QUE3R0Qsd0RBQWtHO0FBZTNGLEtBQUssVUFBVSxtQkFBbUIsQ0FDdkMsYUFBcUIsRUFDckIsZUFBdUIsRUFDdkIsWUFBOEIsRUFDOUIsV0FBMEI7SUFFMUIsTUFBTSxJQUFBLHlCQUFPLEVBQUMsd0JBQU0sQ0FBQyxXQUFXLEVBQUU7UUFDaEMsYUFBYTtRQUNiLGVBQWU7UUFDZixZQUFZO1FBQ1osV0FBVztRQUNYLFFBQVEsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtRQUNsQyxVQUFVLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7S0FDckMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVNLEtBQUssVUFBVSxtQkFBbUIsQ0FDdkMsYUFBcUIsRUFDckIsZUFBdUI7SUFFdkIsT0FBTyxNQUFNLElBQUEseUJBQU8sRUFBeUIsd0JBQU0sQ0FBQyxXQUFXLEVBQUU7UUFDL0QsYUFBYTtRQUNiLGVBQWU7S0FDaEIsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVNLEtBQUssVUFBVSxvQkFBb0IsQ0FDeEMsYUFBcUI7SUFFckIsT0FBTyxNQUFNLElBQUEsNEJBQVUsRUFDckIsd0JBQU0sQ0FBQyxXQUFXLEVBQ2xCLGdDQUFnQyxFQUNoQyxFQUFFLGdCQUFnQixFQUFFLGFBQWEsRUFBRSxDQUNwQyxDQUFDO0FBQ0osQ0FBQztBQUVNLEtBQUssVUFBVSwyQkFBMkIsQ0FDL0MsYUFBcUIsRUFDckIsZUFBdUIsRUFDdkIsV0FBMEI7SUFFMUIsTUFBTSxJQUFBLDRCQUFVLEVBQ2Qsd0JBQU0sQ0FBQyxXQUFXLEVBQ2xCLEVBQUUsYUFBYSxFQUFFLGVBQWUsRUFBRSxFQUNsQywwREFBMEQsRUFDMUQ7UUFDRSxjQUFjLEVBQUUsV0FBVztRQUMzQixhQUFhLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7S0FDeEMsQ0FDRixDQUFDO0FBQ0osQ0FBQztBQUVNLEtBQUssVUFBVSw0QkFBNEIsQ0FDaEQsYUFBcUIsRUFDckIsZUFBdUIsRUFDdkIsWUFBOEI7SUFFOUIsTUFBTSxJQUFBLDRCQUFVLEVBQ2Qsd0JBQU0sQ0FBQyxXQUFXLEVBQ2xCLEVBQUUsYUFBYSxFQUFFLGVBQWUsRUFBRSxFQUNsQyw0REFBNEQsRUFDNUQ7UUFDRSxlQUFlLEVBQUUsWUFBWTtRQUM3QixhQUFhLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7S0FDeEMsQ0FDRixDQUFDO0FBQ0osQ0FBQztBQUVNLEtBQUssVUFBVSwwQkFBMEIsQ0FDOUMsYUFBcUIsRUFDckIsZUFBdUI7SUFFdkIsTUFBTSxJQUFBLDRCQUFVLEVBQ2Qsd0JBQU0sQ0FBQyxXQUFXLEVBQ2xCLEVBQUUsYUFBYSxFQUFFLGVBQWUsRUFBRSxFQUNsQyw4QkFBOEIsRUFDOUIsRUFBRSxhQUFhLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsRUFBRSxDQUM1QyxDQUFDO0FBQ0osQ0FBQztBQUVNLEtBQUssVUFBVSxzQkFBc0IsQ0FDMUMsYUFBcUIsRUFDckIsZUFBdUI7SUFFdkIsTUFBTSxJQUFBLDRCQUFVLEVBQUMsd0JBQU0sQ0FBQyxXQUFXLEVBQUUsRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFFLENBQUMsQ0FBQztBQUMzRSxDQUFDO0FBRU0sS0FBSyxVQUFVLGVBQWUsQ0FDbkMsYUFBcUIsRUFDckIsZUFBdUIsRUFDdkIsVUFBK0I7SUFFL0IsTUFBTSxNQUFNLEdBQUcsTUFBTSxtQkFBbUIsQ0FBQyxhQUFhLEVBQUUsZUFBZSxDQUFDLENBQUM7SUFDekUsT0FBTyxNQUFNLEVBQUUsV0FBVyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEtBQUssQ0FBQztBQUNsRCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ2FyZSBDaXJjbGUgVGFibGUgRGF0YSBBY2Nlc3MgTGF5ZXJcbi8vIFJlcXVpcmVtZW50czogNC4xLCA4LjEsIDguNCwgOC41XG5cbmltcG9ydCB7IENhcmVDaXJjbGVNZW1iZXIsIFBlcm1pc3Npb25TZXQsIFJlbGF0aW9uc2hpcFR5cGUgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBUQUJMRVMsIHB1dEl0ZW0sIGdldEl0ZW0sIHF1ZXJ5SXRlbXMsIHVwZGF0ZUl0ZW0sIGRlbGV0ZUl0ZW0gfSBmcm9tICcuLi9keW5hbW9kYi1jbGllbnQnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDYXJlIENpcmNsZSBPcGVyYXRpb25zXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmludGVyZmFjZSBDYXJlQ2lyY2xlUmVsYXRpb25zaGlwIHtcbiAgcHJpbWFyeVVzZXJJZDogc3RyaW5nO1xuICBzZWNvbmRhcnlVc2VySWQ6IHN0cmluZztcbiAgcmVsYXRpb25zaGlwOiBSZWxhdGlvbnNoaXBUeXBlO1xuICBwZXJtaXNzaW9uczogUGVybWlzc2lvblNldDtcbiAgam9pbmVkQXQ6IHN0cmluZztcbiAgbGFzdEFjdGl2ZTogc3RyaW5nO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYWRkQ2FyZUNpcmNsZU1lbWJlcihcbiAgcHJpbWFyeVVzZXJJZDogc3RyaW5nLFxuICBzZWNvbmRhcnlVc2VySWQ6IHN0cmluZyxcbiAgcmVsYXRpb25zaGlwOiBSZWxhdGlvbnNoaXBUeXBlLFxuICBwZXJtaXNzaW9uczogUGVybWlzc2lvblNldFxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGF3YWl0IHB1dEl0ZW0oVEFCTEVTLkNBUkVfQ0lSQ0xFLCB7XG4gICAgcHJpbWFyeVVzZXJJZCxcbiAgICBzZWNvbmRhcnlVc2VySWQsXG4gICAgcmVsYXRpb25zaGlwLFxuICAgIHBlcm1pc3Npb25zLFxuICAgIGpvaW5lZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgbGFzdEFjdGl2ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENhcmVDaXJjbGVNZW1iZXIoXG4gIHByaW1hcnlVc2VySWQ6IHN0cmluZyxcbiAgc2Vjb25kYXJ5VXNlcklkOiBzdHJpbmdcbik6IFByb21pc2U8Q2FyZUNpcmNsZVJlbGF0aW9uc2hpcCB8IG51bGw+IHtcbiAgcmV0dXJuIGF3YWl0IGdldEl0ZW08Q2FyZUNpcmNsZVJlbGF0aW9uc2hpcD4oVEFCTEVTLkNBUkVfQ0lSQ0xFLCB7XG4gICAgcHJpbWFyeVVzZXJJZCxcbiAgICBzZWNvbmRhcnlVc2VySWQsXG4gIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q2FyZUNpcmNsZU1lbWJlcnMoXG4gIHByaW1hcnlVc2VySWQ6IHN0cmluZ1xuKTogUHJvbWlzZTxDYXJlQ2lyY2xlUmVsYXRpb25zaGlwW10+IHtcbiAgcmV0dXJuIGF3YWl0IHF1ZXJ5SXRlbXM8Q2FyZUNpcmNsZVJlbGF0aW9uc2hpcD4oXG4gICAgVEFCTEVTLkNBUkVfQ0lSQ0xFLFxuICAgICdwcmltYXJ5VXNlcklkID0gOnByaW1hcnlVc2VySWQnLFxuICAgIHsgJzpwcmltYXJ5VXNlcklkJzogcHJpbWFyeVVzZXJJZCB9XG4gICk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVDYXJlQ2lyY2xlUGVybWlzc2lvbnMoXG4gIHByaW1hcnlVc2VySWQ6IHN0cmluZyxcbiAgc2Vjb25kYXJ5VXNlcklkOiBzdHJpbmcsXG4gIHBlcm1pc3Npb25zOiBQZXJtaXNzaW9uU2V0XG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgYXdhaXQgdXBkYXRlSXRlbShcbiAgICBUQUJMRVMuQ0FSRV9DSVJDTEUsXG4gICAgeyBwcmltYXJ5VXNlcklkLCBzZWNvbmRhcnlVc2VySWQgfSxcbiAgICAnU0VUIHBlcm1pc3Npb25zID0gOnBlcm1pc3Npb25zLCBsYXN0QWN0aXZlID0gOmxhc3RBY3RpdmUnLFxuICAgIHtcbiAgICAgICc6cGVybWlzc2lvbnMnOiBwZXJtaXNzaW9ucyxcbiAgICAgICc6bGFzdEFjdGl2ZSc6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9XG4gICk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVDYXJlQ2lyY2xlUmVsYXRpb25zaGlwKFxuICBwcmltYXJ5VXNlcklkOiBzdHJpbmcsXG4gIHNlY29uZGFyeVVzZXJJZDogc3RyaW5nLFxuICByZWxhdGlvbnNoaXA6IFJlbGF0aW9uc2hpcFR5cGVcbik6IFByb21pc2U8dm9pZD4ge1xuICBhd2FpdCB1cGRhdGVJdGVtKFxuICAgIFRBQkxFUy5DQVJFX0NJUkNMRSxcbiAgICB7IHByaW1hcnlVc2VySWQsIHNlY29uZGFyeVVzZXJJZCB9LFxuICAgICdTRVQgcmVsYXRpb25zaGlwID0gOnJlbGF0aW9uc2hpcCwgbGFzdEFjdGl2ZSA9IDpsYXN0QWN0aXZlJyxcbiAgICB7XG4gICAgICAnOnJlbGF0aW9uc2hpcCc6IHJlbGF0aW9uc2hpcCxcbiAgICAgICc6bGFzdEFjdGl2ZSc6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9XG4gICk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVDYXJlQ2lyY2xlTGFzdEFjdGl2ZShcbiAgcHJpbWFyeVVzZXJJZDogc3RyaW5nLFxuICBzZWNvbmRhcnlVc2VySWQ6IHN0cmluZ1xuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGF3YWl0IHVwZGF0ZUl0ZW0oXG4gICAgVEFCTEVTLkNBUkVfQ0lSQ0xFLFxuICAgIHsgcHJpbWFyeVVzZXJJZCwgc2Vjb25kYXJ5VXNlcklkIH0sXG4gICAgJ1NFVCBsYXN0QWN0aXZlID0gOmxhc3RBY3RpdmUnLFxuICAgIHsgJzpsYXN0QWN0aXZlJzogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH1cbiAgKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlbW92ZUNhcmVDaXJjbGVNZW1iZXIoXG4gIHByaW1hcnlVc2VySWQ6IHN0cmluZyxcbiAgc2Vjb25kYXJ5VXNlcklkOiBzdHJpbmdcbik6IFByb21pc2U8dm9pZD4ge1xuICBhd2FpdCBkZWxldGVJdGVtKFRBQkxFUy5DQVJFX0NJUkNMRSwgeyBwcmltYXJ5VXNlcklkLCBzZWNvbmRhcnlVc2VySWQgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1Blcm1pc3Npb24oXG4gIHByaW1hcnlVc2VySWQ6IHN0cmluZyxcbiAgc2Vjb25kYXJ5VXNlcklkOiBzdHJpbmcsXG4gIHBlcm1pc3Npb246IGtleW9mIFBlcm1pc3Npb25TZXRcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBjb25zdCBtZW1iZXIgPSBhd2FpdCBnZXRDYXJlQ2lyY2xlTWVtYmVyKHByaW1hcnlVc2VySWQsIHNlY29uZGFyeVVzZXJJZCk7XG4gIHJldHVybiBtZW1iZXI/LnBlcm1pc3Npb25zW3Blcm1pc3Npb25dIHx8IGZhbHNlO1xufVxuIl19