"use strict";
// Users Table Data Access Layer
// Requirements: 8.1, 8.4
Object.defineProperty(exports, "__esModule", { value: true });
exports.createUser = createUser;
exports.getUser = getUser;
exports.getUserByEmail = getUserByEmail;
exports.updateUserProfile = updateUserProfile;
exports.updateLastActive = updateLastActive;
exports.deleteUser = deleteUser;
const dynamodb_client_1 = require("../dynamodb-client");
// ============================================================================
// User Operations
// ============================================================================
async function createUser(user) {
    await (0, dynamodb_client_1.putItem)(dynamodb_client_1.TABLES.USERS, {
        ...user,
        createdAt: new Date().toISOString(),
        lastActive: new Date().toISOString(),
    });
}
async function getUser(userId) {
    return await (0, dynamodb_client_1.getItem)(dynamodb_client_1.TABLES.USERS, { userId });
}
async function getUserByEmail(email) {
    const results = await (0, dynamodb_client_1.queryItems)(dynamodb_client_1.TABLES.USERS, 'email = :email', { ':email': email }, 'email-index', undefined, 1);
    return results[0] || null;
}
async function updateUserProfile(userId, updates) {
    const updateExpressions = [];
    const expressionAttributeValues = {};
    const expressionAttributeNames = {};
    Object.entries(updates).forEach(([key, value], index) => {
        const attrName = `#attr${index}`;
        const attrValue = `:val${index}`;
        updateExpressions.push(`${attrName} = ${attrValue}`);
        expressionAttributeNames[attrName] = key;
        expressionAttributeValues[attrValue] = value;
    });
    await (0, dynamodb_client_1.updateItem)(dynamodb_client_1.TABLES.USERS, { userId }, `SET ${updateExpressions.join(', ')}, lastActive = :lastActive`, { ...expressionAttributeValues, ':lastActive': new Date().toISOString() }, expressionAttributeNames);
}
async function updateLastActive(userId) {
    await (0, dynamodb_client_1.updateItem)(dynamodb_client_1.TABLES.USERS, { userId }, 'SET lastActive = :lastActive', { ':lastActive': new Date().toISOString() });
}
async function deleteUser(userId) {
    await (0, dynamodb_client_1.deleteItem)(dynamodb_client_1.TABLES.USERS, { userId });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1c2Vycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsZ0NBQWdDO0FBQ2hDLHlCQUF5Qjs7QUFTekIsZ0NBTUM7QUFFRCwwQkFFQztBQUVELHdDQVVDO0FBRUQsOENBdUJDO0FBRUQsNENBT0M7QUFFRCxnQ0FFQztBQWxFRCx3REFBa0c7QUFFbEcsK0VBQStFO0FBQy9FLGtCQUFrQjtBQUNsQiwrRUFBK0U7QUFFeEUsS0FBSyxVQUFVLFVBQVUsQ0FBQyxJQUFpQztJQUNoRSxNQUFNLElBQUEseUJBQU8sRUFBQyx3QkFBTSxDQUFDLEtBQUssRUFBRTtRQUMxQixHQUFHLElBQUk7UUFDUCxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7UUFDbkMsVUFBVSxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO0tBQ3JDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFTSxLQUFLLFVBQVUsT0FBTyxDQUFDLE1BQWM7SUFDMUMsT0FBTyxNQUFNLElBQUEseUJBQU8sRUFBOEIsd0JBQU0sQ0FBQyxLQUFLLEVBQUUsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0FBQzlFLENBQUM7QUFFTSxLQUFLLFVBQVUsY0FBYyxDQUFDLEtBQWE7SUFDaEQsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFBLDRCQUFVLEVBQzlCLHdCQUFNLENBQUMsS0FBSyxFQUNaLGdCQUFnQixFQUNoQixFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsRUFDbkIsYUFBYSxFQUNiLFNBQVMsRUFDVCxDQUFDLENBQ0YsQ0FBQztJQUNGLE9BQU8sT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQztBQUM1QixDQUFDO0FBRU0sS0FBSyxVQUFVLGlCQUFpQixDQUNyQyxNQUFjLEVBQ2QsT0FBNkM7SUFFN0MsTUFBTSxpQkFBaUIsR0FBYSxFQUFFLENBQUM7SUFDdkMsTUFBTSx5QkFBeUIsR0FBNEIsRUFBRSxDQUFDO0lBQzlELE1BQU0sd0JBQXdCLEdBQTJCLEVBQUUsQ0FBQztJQUU1RCxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFO1FBQ3RELE1BQU0sUUFBUSxHQUFHLFFBQVEsS0FBSyxFQUFFLENBQUM7UUFDakMsTUFBTSxTQUFTLEdBQUcsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNqQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsR0FBRyxRQUFRLE1BQU0sU0FBUyxFQUFFLENBQUMsQ0FBQztRQUNyRCx3QkFBd0IsQ0FBQyxRQUFRLENBQUMsR0FBRyxHQUFHLENBQUM7UUFDekMseUJBQXlCLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDO0lBQy9DLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxJQUFBLDRCQUFVLEVBQ2Qsd0JBQU0sQ0FBQyxLQUFLLEVBQ1osRUFBRSxNQUFNLEVBQUUsRUFDVixPQUFPLGlCQUFpQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsNEJBQTRCLEVBQy9ELEVBQUUsR0FBRyx5QkFBeUIsRUFBRSxhQUFhLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsRUFBRSxFQUN6RSx3QkFBd0IsQ0FDekIsQ0FBQztBQUNKLENBQUM7QUFFTSxLQUFLLFVBQVUsZ0JBQWdCLENBQUMsTUFBYztJQUNuRCxNQUFNLElBQUEsNEJBQVUsRUFDZCx3QkFBTSxDQUFDLEtBQUssRUFDWixFQUFFLE1BQU0sRUFBRSxFQUNWLDhCQUE4QixFQUM5QixFQUFFLGFBQWEsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQzVDLENBQUM7QUFDSixDQUFDO0FBRU0sS0FBSyxVQUFVLFVBQVUsQ0FBQyxNQUFjO0lBQzdDLE1BQU0sSUFBQSw0QkFBVSxFQUFDLHdCQUFNLENBQUMsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztBQUM3QyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVXNlcnMgVGFibGUgRGF0YSBBY2Nlc3MgTGF5ZXJcbi8vIFJlcXVpcmVtZW50czogOC4xLCA4LjRcblxuaW1wb3J0IHsgUHJpbWFyeVVzZXIsIFNlY29uZGFyeVVzZXIgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBUQUJMRVMsIHB1dEl0ZW0sIGdldEl0ZW0sIHF1ZXJ5SXRlbXMsIHVwZGF0ZUl0ZW0sIGRlbGV0ZUl0ZW0gfSBmcm9tICcuLi9keW5hbW9kYi1jbGllbnQnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBVc2VyIE9wZXJhdGlvbnNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVVzZXIodXNlcjogUHJpbWFyeVVzZXIgfCBTZWNvbmRhcnlVc2VyKTogUHJvbWlzZTx2b2lkPiB7XG4gIGF3YWl0IHB1dEl0ZW0oVEFCTEVTLlVTRVJTLCB7XG4gICAgLi4udXNlcixcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICBsYXN0QWN0aXZlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlcih1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8UHJpbWFyeVVzZXIgfCBTZWNvbmRhcnlVc2VyIHwgbnVsbD4ge1xuICByZXR1cm4gYXdhaXQgZ2V0SXRlbTxQcmltYXJ5VXNlciB8IFNlY29uZGFyeVVzZXI+KFRBQkxFUy5VU0VSUywgeyB1c2VySWQgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyQnlFbWFpbChlbWFpbDogc3RyaW5nKTogUHJvbWlzZTxQcmltYXJ5VXNlciB8IFNlY29uZGFyeVVzZXIgfCBudWxsPiB7XG4gIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBxdWVyeUl0ZW1zPFByaW1hcnlVc2VyIHwgU2Vjb25kYXJ5VXNlcj4oXG4gICAgVEFCTEVTLlVTRVJTLFxuICAgICdlbWFpbCA9IDplbWFpbCcsXG4gICAgeyAnOmVtYWlsJzogZW1haWwgfSxcbiAgICAnZW1haWwtaW5kZXgnLFxuICAgIHVuZGVmaW5lZCxcbiAgICAxXG4gICk7XG4gIHJldHVybiByZXN1bHRzWzBdIHx8IG51bGw7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVVc2VyUHJvZmlsZShcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHVwZGF0ZXM6IFBhcnRpYWw8UHJpbWFyeVVzZXIgfCBTZWNvbmRhcnlVc2VyPlxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHVwZGF0ZUV4cHJlc3Npb25zOiBzdHJpbmdbXSA9IFtdO1xuICBjb25zdCBleHByZXNzaW9uQXR0cmlidXRlVmFsdWVzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9O1xuICBjb25zdCBleHByZXNzaW9uQXR0cmlidXRlTmFtZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcblxuICBPYmplY3QuZW50cmllcyh1cGRhdGVzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0sIGluZGV4KSA9PiB7XG4gICAgY29uc3QgYXR0ck5hbWUgPSBgI2F0dHIke2luZGV4fWA7XG4gICAgY29uc3QgYXR0clZhbHVlID0gYDp2YWwke2luZGV4fWA7XG4gICAgdXBkYXRlRXhwcmVzc2lvbnMucHVzaChgJHthdHRyTmFtZX0gPSAke2F0dHJWYWx1ZX1gKTtcbiAgICBleHByZXNzaW9uQXR0cmlidXRlTmFtZXNbYXR0ck5hbWVdID0ga2V5O1xuICAgIGV4cHJlc3Npb25BdHRyaWJ1dGVWYWx1ZXNbYXR0clZhbHVlXSA9IHZhbHVlO1xuICB9KTtcblxuICBhd2FpdCB1cGRhdGVJdGVtKFxuICAgIFRBQkxFUy5VU0VSUyxcbiAgICB7IHVzZXJJZCB9LFxuICAgIGBTRVQgJHt1cGRhdGVFeHByZXNzaW9ucy5qb2luKCcsICcpfSwgbGFzdEFjdGl2ZSA9IDpsYXN0QWN0aXZlYCxcbiAgICB7IC4uLmV4cHJlc3Npb25BdHRyaWJ1dGVWYWx1ZXMsICc6bGFzdEFjdGl2ZSc6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9LFxuICAgIGV4cHJlc3Npb25BdHRyaWJ1dGVOYW1lc1xuICApO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlTGFzdEFjdGl2ZSh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICBhd2FpdCB1cGRhdGVJdGVtKFxuICAgIFRBQkxFUy5VU0VSUyxcbiAgICB7IHVzZXJJZCB9LFxuICAgICdTRVQgbGFzdEFjdGl2ZSA9IDpsYXN0QWN0aXZlJyxcbiAgICB7ICc6bGFzdEFjdGl2ZSc6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9XG4gICk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVVc2VyKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gIGF3YWl0IGRlbGV0ZUl0ZW0oVEFCTEVTLlVTRVJTLCB7IHVzZXJJZCB9KTtcbn1cbiJdfQ==